
<!DOCTYPE html>

<html data-content_root="./" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Understanding Jaxprs â€” JAX  documentation</title>
<script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
<!-- Loaded before other Sphinx assets -->
<link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet"/>
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet"/>
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet"/>
<link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet"/>
<link as="font" crossorigin="" href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" rel="preload" type="font/woff2"/>
<link href="_static/pygments.css?v=a746c00c" rel="stylesheet" type="text/css"/>
<link href="_static/styles/sphinx-book-theme.css?v=384b581d" rel="stylesheet" type="text/css"/>
<link href="_static/plot_directive.css" rel="stylesheet" type="text/css"/>
<link href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" rel="stylesheet" type="text/css"/>
<link href="_static/copybutton.css?v=76b2166b" rel="stylesheet" type="text/css"/>
<link href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" rel="stylesheet" type="text/css"/>
<link href="_static/style.css?v=02ed413a" rel="stylesheet" type="text/css"/>
<link href="_static/style.css" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" rel="preload"/>
<link as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" rel="preload"/>
<script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/documentation_options.js?v=9eb32ce0"></script>
<script src="_static/doctools.js?v=9a2dae69"></script>
<script src="_static/sphinx_highlight.js?v=dc90522c"></script>
<script src="_static/clipboard.min.js?v=a7894cd8"></script>
<script src="_static/copybutton.js?v=f281be69"></script>
<script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
<script src="_static/design-tabs.js?v=36754332"></script>
<script>DOCUMENTATION_OPTIONS.pagename = 'jaxpr';</script>
<link href="_static/favicon.png" rel="icon"/>
<link href="genindex.html" rel="index" title="Index"/>
<link href="search.html" rel="search" title="Search"/>
<link href="notebooks/external_callbacks.html" rel="next" title="External Callbacks in JAX"/>
<link href="persistent_compilation_cache.html" rel="prev" title="Persistent Compilation Cache"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="en" name="docsearch:language"/>
</head>
<body data-bs-root-margin="0px 0px -60%" data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-default-mode="" data-offset="180">
<a class="skip-link" href="#main-content" id="pst-skip-link">Skip to main content</a>
<div id="pst-scroll-pixel-helper"></div>
<button class="btn rounded-pill" id="pst-back-to-top" type="button">
<i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>
<input class="sidebar-toggle" id="__primary" name="__primary" type="checkbox"/>
<label class="overlay overlay-primary" for="__primary"></label>
<input class="sidebar-toggle" id="__secondary" name="__secondary" type="checkbox"/>
<label class="overlay overlay-secondary" for="__secondary"></label>
<div class="search-button__wrapper">
<div class="search-button__overlay"></div>
<div class="search-button__search-container">
<form action="search.html" class="bd-search d-flex align-items-center" method="get">
<i class="fa-solid fa-magnifying-glass"></i>
<input aria-label="Search..." autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" id="search-input" name="q" placeholder="Search..." spellcheck="false" type="search"/>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
</div>
<header class="bd-header navbar navbar-expand-lg bd-navbar">
</header>
<div class="bd-container">
<div class="bd-container__inner bd-page-width">
<div class="bd-sidebar-primary bd-sidebar">
<div class="sidebar-header-items sidebar-primary__section">
</div>
<div class="sidebar-primary-items__start sidebar-primary__section">
<div class="sidebar-primary-item">
<a class="navbar-brand logo" href="index.html">
<img alt="JAX  documentation - Home" class="logo__image only-light" src="_static/jax_logo_250px.png"/>
<script>document.write(`<img src="_static/jax_logo_250px.png" class="logo__image only-dark" alt="JAX  documentation - Home"/>`);</script>
</a></div>
<div class="sidebar-primary-item">
<script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
<div class="sidebar-primary-item"><nav aria-label="Main" class="bd-links bd-docs-nav">
<div class="bd-toc-item navbar-nav active">
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installing JAX</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/quickstart.html">JAX Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/thinking_in_jax.html">How to Think in JAX</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/Common_Gotchas_in_JAX.html">ðŸ”ª JAX - The Sharp Bits ðŸ”ª</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">JAX Frequently Asked Questions (FAQ)</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="jax-101/index.html">Tutorial: JAX 101</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="jax-101/01-jax-basics.html">JAX As Accelerated NumPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax-101/02-jitting.html">Just In Time Compilation with JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax-101/03-vectorization.html">Automatic Vectorization in JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax-101/04-advanced-autodiff.html">Advanced Automatic Differentiation in JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax-101/05-random-numbers.html">Pseudo Random Numbers in JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax-101/05.1-pytrees.html">Working with Pytrees</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax-101/06-parallelism.html">Parallel Evaluation in JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax-101/07-state.html">Stateful Computations in JAX</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Further Resources</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="user_guides.html">User Guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="profiling.html">Profiling JAX programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_memory_profiling.html">Device Memory Profiling</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="debugging/index.html">Runtime value debugging in JAX</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="debugging/print_breakpoint.html"><code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> and <code class="docutils literal notranslate"><span class="pre">jax.debug.breakpoint</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging/checkify_guide.html">The <code class="docutils literal notranslate"><span class="pre">checkify</span></code> transformation</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging/flags.html">JAX debugging flags</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gpu_performance_tips.html">GPU performance tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="persistent_compilation_cache.html">Persistent Compilation Cache</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Understanding Jaxprs</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/external_callbacks.html">External Callbacks in JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="type_promotion.html">Type promotion semantics</a></li>
<li class="toctree-l2"><a class="reference internal" href="pytrees.html">Pytrees</a></li>
<li class="toctree-l2"><a class="reference internal" href="aot.html">Ahead-of-time lowering and compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html">JAX Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="transfer_guard.html">Transfer guard</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="pallas/index.html">Pallas: a JAX kernel language</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="pallas/design.html">Pallas Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="pallas/quickstart.html">Pallas Quickstart</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="pallas/tpu/index.html">Pallas TPU</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="pallas/tpu/details.html">Writing TPU kernels with Pallas</a></li>
<li class="toctree-l4"><a class="reference internal" href="pallas/tpu/pipelining.html">Pipelining and <code class="docutils literal notranslate"><span class="pre">BlockSpec</span></code>s</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="advanced_guide.html">Advanced Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="notebooks/neural_network_with_tfds_data.html">Training a Simple Neural Network, with tensorflow/datasets Data Loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/Neural_Network_and_Data_Loading.html">Training a Simple Neural Network, with PyTorch Data Loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/vmapped_log_probs.html">Autobatching for Bayesian Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="multi_process.html">Using JAX in multi-host and multi-process environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/Distributed_arrays_and_automatic_parallelization.html">Distributed arrays and automatic parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/shard_map.html">SPMD multi-device parallelism with <code class="docutils literal notranslate"><span class="pre">shard_map</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/xmap_tutorial.html">Named axes and easy-to-revise parallelism with <code class="docutils literal notranslate"><span class="pre">xmap</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/autodiff_cookbook.html">The Autodiff Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/Custom_derivative_rules_for_Python_code.html">Custom derivative rules for JAX-transformable Python functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/autodiff_remat.html">Control autodiffâ€™s saved values with <code class="docutils literal notranslate"><span class="pre">jax.checkpoint</span></code> (aka <code class="docutils literal notranslate"><span class="pre">jax.remat</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/How_JAX_primitives_work.html">How JAX primitives work</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/Writing_custom_interpreters_in_Jax.html">Writing custom Jaxpr interpreters in JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="Custom_Operation_for_GPUs.html">Custom operations for GPUs with C++ and CUDA</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/convolutions.html">Generalized Convolutions in JAX</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="contributor_guide.html">Developer Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing to JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer.html">Building from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax_internal_api.html">Internal APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="autodidax.html">Autodidax: JAX core from scratch</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="jep/index.html">JAX Enhancement Proposals (JEPs)</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="jep/263-prng.html">263: JAX PRNG Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/2026-custom-derivatives.html">2026: Custom JVP/VJP rules for JAX-transformable functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/4008-custom-vjp-update.html">4008: Custom VJP and `nondiff_argnums` update</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/4410-omnistaging.html">4410: Omnistaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/9263-typed-keys.html">9263: Typed keys &amp; pluggable RNGs</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/9407-type-promotion.html">9407: Design of Type Promotion Semantics for JAX</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/9419-jax-versioning.html">9419: Jax and Jaxlib versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/10657-sequencing-effects.html">10657: Sequencing side-effects in JAX</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/11830-new-remat-checkpoint.html">11830: `jax.remat` / `jax.checkpoint` new implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/12049-type-annotations.html">12049: Type Annotation Roadmap for JAX</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/14273-shard-map.html">14273: `shard_map` (`shmap`) for simple per-device code</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/15856-jex.html">15856: `jax.extend`, an extensions module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/17111-shmap-transpose.html">17111: Efficient transposition of `shard_map` (and other maps)</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/18137-numpy-scipy-scope.html">18137: Scope of JAX NumPy &amp; SciPy Wrappers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="investigating_a_regression.html">Investigating a regression</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="building_on_jax.html">Building on JAX</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="notes.html">Notes</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api_compatibility.html">API compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="deprecation.html">Python and NumPy version support policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax_array_migration.html">jax.Array migration</a></li>
<li class="toctree-l2"><a class="reference internal" href="async_dispatch.html">Asynchronous dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrency.html">Concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu_memory_allocation.html">GPU memory allocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="rank_promotion_warning.html">Rank promotion warning</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="jax.html">Public API: jax package</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="jax.numpy.html"><code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.fft.html">jax.numpy.fft.fft</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.fft2.html">jax.numpy.fft.fft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.fftfreq.html">jax.numpy.fft.fftfreq</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.fftn.html">jax.numpy.fft.fftn</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.fftshift.html">jax.numpy.fft.fftshift</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.hfft.html">jax.numpy.fft.hfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.ifft.html">jax.numpy.fft.ifft</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.ifft2.html">jax.numpy.fft.ifft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.ifftn.html">jax.numpy.fft.ifftn</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.ifftshift.html">jax.numpy.fft.ifftshift</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.ihfft.html">jax.numpy.fft.ihfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.irfft.html">jax.numpy.fft.irfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.irfft2.html">jax.numpy.fft.irfft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.irfftn.html">jax.numpy.fft.irfftn</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.rfft.html">jax.numpy.fft.rfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.rfft2.html">jax.numpy.fft.rfft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.rfftfreq.html">jax.numpy.fft.rfftfreq</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.rfftn.html">jax.numpy.fft.rfftn</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="jax.scipy.html"><code class="docutils literal notranslate"><span class="pre">jax.scipy</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.scipy.stats.bernoulli.logpmf.html">jax.scipy.stats.bernoulli.logpmf</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.scipy.stats.bernoulli.pmf.html">jax.scipy.stats.bernoulli.pmf</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.scipy.stats.bernoulli.cdf.html">jax.scipy.stats.bernoulli.cdf</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.scipy.stats.bernoulli.ppf.html">jax.scipy.stats.bernoulli.ppf</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jax.lax.html"><code class="docutils literal notranslate"><span class="pre">jax.lax</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.random.html"><code class="docutils literal notranslate"><span class="pre">jax.random</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.sharding.html"><code class="docutils literal notranslate"><span class="pre">jax.sharding</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.debug.html"><code class="docutils literal notranslate"><span class="pre">jax.debug</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.dlpack.html"><code class="docutils literal notranslate"><span class="pre">jax.dlpack</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.distributed.html"><code class="docutils literal notranslate"><span class="pre">jax.distributed</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.dtypes.html"><code class="docutils literal notranslate"><span class="pre">jax.dtypes</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.flatten_util.html"><code class="docutils literal notranslate"><span class="pre">jax.flatten_util</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.image.html"><code class="docutils literal notranslate"><span class="pre">jax.image</span></code> module</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="jax.nn.html"><code class="docutils literal notranslate"><span class="pre">jax.nn</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="jax.nn.initializers.html"><code class="docutils literal notranslate"><span class="pre">jax.nn.initializers</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jax.ops.html"><code class="docutils literal notranslate"><span class="pre">jax.ops</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.profiler.html"><code class="docutils literal notranslate"><span class="pre">jax.profiler</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.stages.html"><code class="docutils literal notranslate"><span class="pre">jax.stages</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.tree.html"><code class="docutils literal notranslate"><span class="pre">jax.tree</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.tree_util.html"><code class="docutils literal notranslate"><span class="pre">jax.tree_util</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.typing.html"><code class="docutils literal notranslate"><span class="pre">jax.typing</span></code> module</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="jax.extend.html"><code class="docutils literal notranslate"><span class="pre">jax.extend</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="jax.extend.linear_util.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.linear_util</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.extend.mlir.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.mlir</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.extend.random.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.random</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="jax.example_libraries.html"><code class="docutils literal notranslate"><span class="pre">jax.example_libraries</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="jax.example_libraries.optimizers.html"><code class="docutils literal notranslate"><span class="pre">jax.example_libraries.optimizers</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.example_libraries.stax.html"><code class="docutils literal notranslate"><span class="pre">jax.example_libraries.stax</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="jax.experimental.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.array_api.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.array_api</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.checkify.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.checkify</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.host_callback.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.host_callback</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.maps.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.maps</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.pjit.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.pjit</span></code> module</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="jax.experimental.sparse.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.sparse</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.BCOO.html">jax.experimental.sparse.BCOO</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_broadcast_in_dim.html">jax.experimental.sparse.bcoo_broadcast_in_dim</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_concatenate.html">jax.experimental.sparse.bcoo_concatenate</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_dot_general.html">jax.experimental.sparse.bcoo_dot_general</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_dot_general_sampled.html">jax.experimental.sparse.bcoo_dot_general_sampled</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_dynamic_slice.html">jax.experimental.sparse.bcoo_dynamic_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_extract.html">jax.experimental.sparse.bcoo_extract</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_fromdense.html">jax.experimental.sparse.bcoo_fromdense</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_gather.html">jax.experimental.sparse.bcoo_gather</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_multiply_dense.html">jax.experimental.sparse.bcoo_multiply_dense</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_multiply_sparse.html">jax.experimental.sparse.bcoo_multiply_sparse</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_update_layout.html">jax.experimental.sparse.bcoo_update_layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_reduce_sum.html">jax.experimental.sparse.bcoo_reduce_sum</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_reshape.html">jax.experimental.sparse.bcoo_reshape</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_slice.html">jax.experimental.sparse.bcoo_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_sort_indices.html">jax.experimental.sparse.bcoo_sort_indices</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_squeeze.html">jax.experimental.sparse.bcoo_squeeze</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_sum_duplicates.html">jax.experimental.sparse.bcoo_sum_duplicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_todense.html">jax.experimental.sparse.bcoo_todense</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_transpose.html">jax.experimental.sparse.bcoo_transpose</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.jet.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.jet</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.custom_partitioning.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.custom_partitioning</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.multihost_utils.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.multihost_utils</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.compilation_cache.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.compilation_cache</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.key_reuse.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.key_reuse</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.mesh_utils.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.mesh_utils</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jax.lib.html"><code class="docutils literal notranslate"><span class="pre">jax.lib</span></code> module</a></li>
</ul>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change log</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">JAX Glossary of Terms</a></li>
</ul>
</div>
</nav></div>
</div>
<div class="sidebar-primary-items__end sidebar-primary__section">
</div>
<div id="rtd-footer-container"></div>
</div>
<main class="bd-main" id="main-content">
<div class="sbt-scroll-pixel-helper"></div>
<div class="bd-content">
<div class="bd-article-container">
<div class="bd-header-article">
<div class="header-article-items header-article__inner">
<div class="header-article-items__start">
<div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" data-bs-placement="bottom" data-bs-toggle="tooltip" for="__primary" title="Toggle primary sidebar">
<span class="fa-solid fa-bars"></span>
</label></div>
</div>
<div class="header-article-items__end">
<div class="header-article-item">
<div class="article-header-buttons">
<a class="btn btn-sm btn-source-repository-button" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://github.com/google/jax" target="_blank" title="Source repository">
<span class="btn__icon-container">
<i class="fab fa-github"></i>
</span>
</a>
<div class="dropdown dropdown-download-buttons">
<button aria-expanded="false" aria-label="Download this page" class="btn dropdown-toggle" data-bs-toggle="dropdown" type="button">
<i class="fas fa-download"></i>
</button>
<ul class="dropdown-menu">
<li><a class="btn btn-sm btn-download-source-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="_sources/jaxpr.rst" target="_blank" title="Download source file">
<span class="btn__icon-container">
<i class="fas fa-file"></i>
</span>
<span class="btn__text-container">.rst</span>
</a>
</li>
<li>
<button class="btn btn-sm btn-download-pdf-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" onclick="window.print()" title="Print to PDF">
<span class="btn__icon-container">
<i class="fas fa-file-pdf"></i>
</span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
</ul>
</div>
<button class="btn btn-sm btn-fullscreen-button" data-bs-placement="bottom" data-bs-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
<span class="btn__icon-container">
<i class="fas fa-expand"></i>
</span>
</button>
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" data-bs-placement="bottom" data-bs-toggle="tooltip" for="__secondary" title="Toggle secondary sidebar">
<span class="fa-solid fa-list"></span>
</label>
</div></div>
</div>
</div>
</div>
<div class="onlyprint" id="jb-print-docs-body">
<h1>Understanding Jaxprs</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-pytrees">Handling PyTrees</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constant-vars">Constant Vars</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#higher-order-primitives">Higher-order primitives</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conditionals">Conditionals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#while">While</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scan">Scan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xla-call">XLA_call</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xla-pmap">XLA_pmap</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div id="searchbox"></div>
<article class="bd-article">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Understanding Jaxprs"></a><section id="understanding-jaxprs">
<span id="id1"></span><h1>Understanding Jaxprs<a class="headerlink" href="#understanding-jaxprs" title="Link to this heading">#</a></h1>
<p>Updated: May 3, 2020 (for commit f1a46fe).</p>
<p>Conceptually, one can think of JAX transformations as first trace-specializing
the Python function to be transformed into a small and well-behaved
intermediate form that is then interpreted with transformation-specific
interpretation rules. One of the reasons JAX can pack so much power into such a
small software package is that it starts with a familiar and flexible
programming interface (Python with NumPy) and it uses the actual Python
interpreter to do most of the heavy lifting to distill the essence of the
computation into a simple statically-typed expression language with limited
higher-order features. That language is the jaxpr language.</p>
<p>Not all Python programs can be processed this way, but it turns out that many
scientific computing and machine learning programs can.</p>
<p>Before we proceed, it is important to point out that not all JAX
transformations literally materialize a jaxpr as described above; some, e.g.,
differentiation or batching, will apply transformations incrementally during
tracing. Nevertheless, if one wants to understand how JAX works internally, or
to make use of the result of JAX tracing, it is useful to understand jaxprs.</p>
<p>A jaxpr instance represents a function with one or more typed parameters (input
variables) and one or more typed results. The results depend only on the input
variables; there are no free variables captured from enclosing scopes. The
inputs and outputs have types, which in JAX are represented as abstract values.
There are two related representations in the code for jaxprs,
<a class="reference internal" href="_autosummary/jax.core.Jaxpr.html#jax.core.Jaxpr" title="jax.core.Jaxpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.core.Jaxpr</span></code></a> and <a class="reference internal" href="_autosummary/jax.core.ClosedJaxpr.html#jax.core.ClosedJaxpr" title="jax.core.ClosedJaxpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.core.ClosedJaxpr</span></code></a>. A
<a class="reference internal" href="_autosummary/jax.core.ClosedJaxpr.html#jax.core.ClosedJaxpr" title="jax.core.ClosedJaxpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.core.ClosedJaxpr</span></code></a> represents a partially-applied
<a class="reference internal" href="_autosummary/jax.core.Jaxpr.html#jax.core.Jaxpr" title="jax.core.Jaxpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.core.Jaxpr</span></code></a>, and is what you obtain when you use
<a class="reference internal" href="_autosummary/jax.make_jaxpr.html#jax.make_jaxpr" title="jax.make_jaxpr"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.make_jaxpr()</span></code></a> to inspect jaxprs. It has the following fields:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jaxpr</span></code>: is a <a class="reference internal" href="_autosummary/jax.core.Jaxpr.html#jax.core.Jaxpr" title="jax.core.Jaxpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.core.Jaxpr</span></code></a> representing the actual
computation content of the function (described below).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">consts</span></code> is a list of constants.</p></li>
</ul>
</div></blockquote>
<p>The most interesting part of the ClosedJaxpr is the actual execution content,
represented as a <a class="reference internal" href="_autosummary/jax.core.Jaxpr.html#jax.core.Jaxpr" title="jax.core.Jaxpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.core.Jaxpr</span></code></a> as printed using the following
grammar:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jaxpr</span> <span class="p">:</span><span class="o">:=</span> <span class="p">{</span> <span class="k">lambda</span> <span class="n">Var</span><span class="o">*</span> <span class="p">;</span> <span class="n">Var</span><span class="o">+.</span>
            <span class="n">let</span> <span class="n">Eqn</span><span class="o">*</span>
            <span class="ow">in</span>  <span class="p">[</span><span class="n">Expr</span><span class="o">+</span><span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<dl class="simple">
<dt>where:</dt><dd><ul class="simple">
<li><p>The parameters of the jaxpr are shown as two lists of variables separated by
<code class="docutils literal notranslate"><span class="pre">;</span></code>. The first set of variables are the ones that have been introduced
to stand for constants that have been hoisted out. These are called the
<code class="docutils literal notranslate"><span class="pre">constvars</span></code>, and in a <a class="reference internal" href="_autosummary/jax.core.ClosedJaxpr.html#jax.core.ClosedJaxpr" title="jax.core.ClosedJaxpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.core.ClosedJaxpr</span></code></a> the <code class="docutils literal notranslate"><span class="pre">consts</span></code>
field holds corresponding values. The second list of variables, called
<code class="docutils literal notranslate"><span class="pre">invars</span></code>, correspond to the inputs of the traced Python function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Eqn*</span></code> is a list of equations, defining intermediate variables referring to
intermediate expressions. Each equation defines one or more variables as the
result of applying a primitive on some atomic expressions. Each equation uses only
input variables and intermediate variables defined by previous equations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Expr+</span></code>: is a list of output atomic expressions (literals or variables)
for the jaxpr.</p></li>
</ul>
</dd>
</dl>
<p>Equations are printed as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Eqn</span>  <span class="p">:</span><span class="o">:=</span> <span class="n">let</span> <span class="n">Var</span><span class="o">+</span> <span class="o">=</span> <span class="n">Primitive</span> <span class="p">[</span> <span class="n">Param</span><span class="o">*</span> <span class="p">]</span> <span class="n">Expr</span><span class="o">+</span>
</pre></div>
</div>
<dl class="simple">
<dt>where:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Var+</span></code> are one or more intermediate variables to be defined as the output
of a primitive invocation (some primitives can return multiple values).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Expr+</span></code> are one or more atomic expressions, each either a variable or a
literal constant. A special variable <code class="docutils literal notranslate"><span class="pre">unitvar</span></code> or literal <code class="docutils literal notranslate"><span class="pre">unit</span></code>,
printed as <code class="docutils literal notranslate"><span class="pre">*</span></code>, represents a value that is not needed
in the rest of the computation and has been elided. That is, units are just
placeholders.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Param*</span></code> are zero or more named parameters to the primitive, printed in
square brackets. Each parameter is shown as <code class="docutils literal notranslate"><span class="pre">Name</span> <span class="pre">=</span> <span class="pre">Value</span></code>.</p></li>
</ul>
</dd>
</dl>
<p>Most jaxpr primitives are first-order (they take just one or more Expr as arguments):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Primitive</span> <span class="o">:=</span> <span class="n">add</span> <span class="o">|</span> <span class="n">sub</span> <span class="o">|</span> <span class="n">sin</span> <span class="o">|</span> <span class="n">mul</span> <span class="o">|</span> <span class="o">...</span>
</pre></div>
</div>
<p>The jaxpr primitives are documented in the <a class="reference internal" href="jax.lax.html#module-jax.lax" title="jax.lax"><code class="xref py py-mod docutils literal notranslate"><span class="pre">jax.lax</span></code></a> module.</p>
<p>For example, here is the jaxpr produced for the function <code class="docutils literal notranslate"><span class="pre">func1</span></code> below</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">make_jaxpr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">temp</span> <span class="o">=</span> <span class="n">first</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">second</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3.</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func1</span><span class="p">)(</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">8</span><span class="p">)))</span>
<span class="go">{ lambda ; a:f32[8] b:f32[8]. let</span>
<span class="go">    c:f32[8] = sin b</span>
<span class="go">    d:f32[8] = mul c 3.0</span>
<span class="go">    e:f32[8] = add a d</span>
<span class="go">    f:f32[] = reduce_sum[axes=(0,)] e</span>
<span class="go">  in (f,) }</span>
</pre></div>
</div>
<p>Here there are no constvars, <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are the input variables
and they correspond respectively to
<code class="docutils literal notranslate"><span class="pre">first</span></code> and <code class="docutils literal notranslate"><span class="pre">second</span></code> function parameters. The scalar literal <code class="docutils literal notranslate"><span class="pre">3.0</span></code> is kept
inline.
The <code class="docutils literal notranslate"><span class="pre">reduce_sum</span></code> primitive has named parameters <code class="docutils literal notranslate"><span class="pre">axes</span></code> and <code class="docutils literal notranslate"><span class="pre">input_shape</span></code>, in
addition to the operand <code class="docutils literal notranslate"><span class="pre">e</span></code>.</p>
<p>Note that even though execution of a program that calls into JAX builds a jaxpr,
Python-level control-flow and Python-level functions execute normally.
This means that just because a Python program contains functions and control-flow,
the resulting jaxpr does not have to contain control-flow or higher-order features.</p>
<p>For example, when tracing the function <code class="docutils literal notranslate"><span class="pre">func3</span></code> JAX will inline the call to
<code class="docutils literal notranslate"><span class="pre">inner</span></code> and the conditional <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">second.shape[0]</span> <span class="pre">&gt;</span> <span class="pre">4</span></code>, and will produce the same
jaxpr as before</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func2</span><span class="p">(</span><span class="n">inner</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">):</span>
<span class="gp">... </span>  <span class="n">temp</span> <span class="o">=</span> <span class="n">first</span> <span class="o">+</span> <span class="n">inner</span><span class="p">(</span><span class="n">second</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3.</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">second</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">if</span> <span class="n">second</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
<span class="gp">... </span>  <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="kc">False</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func3</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">func2</span><span class="p">(</span><span class="n">inner</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func3</span><span class="p">)(</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">8</span><span class="p">)))</span>
<span class="go">{ lambda ; a:f32[8] b:f32[8]. let</span>
<span class="go">    c:f32[8] = sin b</span>
<span class="go">    d:f32[8] = mul c 3.0</span>
<span class="go">    e:f32[8] = add a d</span>
<span class="go">    f:f32[] = reduce_sum[axes=(0,)] e</span>
<span class="go">  in (f,) }</span>
</pre></div>
</div>
<section id="handling-pytrees">
<h2>Handling PyTrees<a class="headerlink" href="#handling-pytrees" title="Link to this heading">#</a></h2>
<p>In jaxpr there are no tuple types; instead primitives take multiple inputs
and produce multiple outputs. When processing a function that has structured
inputs or outputs, JAX will flatten those and in jaxpr they will appear as lists
of inputs and outputs. For more details, please see the documentation for
PyTrees (<a class="reference internal" href="pytrees.html#pytrees"><span class="std std-ref">Pytrees</span></a>).</p>
<p>For example, the following code produces an identical jaxpr to what we saw
before (with two input vars, one for each element of the input tuple)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func4</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>  <span class="c1"># Arg is a pair</span>
<span class="gp">... </span>  <span class="n">temp</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">3.</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func4</span><span class="p">)((</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">8</span><span class="p">))))</span>
<span class="go">{ lambda ; a:f32[8] b:f32[8]. let</span>
<span class="go">    c:f32[8] = sin b</span>
<span class="go">    d:f32[8] = mul c 3.0</span>
<span class="go">    e:f32[8] = add a d</span>
<span class="go">    f:f32[] = reduce_sum[axes=(0,)] e</span>
<span class="go">  in (f,) }</span>
</pre></div>
</div>
</section>
<section id="constant-vars">
<h2>Constant Vars<a class="headerlink" href="#constant-vars" title="Link to this heading">#</a></h2>
<p>Some values in jaxprs are constants, in that their value does not depend on the
jaxprâ€™s arguments. When these values are scalars they are represented directly
in the jaxpr equations; non-scalar array constants are instead hoisted out to
the top-level jaxpr, where they correspond to constant variables (â€œconstvarsâ€).
These constvars differ from the other jaxpr parameters (â€œinvarsâ€) only as a
bookkeeping convention.</p>
</section>
<section id="higher-order-primitives">
<h2>Higher-order primitives<a class="headerlink" href="#higher-order-primitives" title="Link to this heading">#</a></h2>
<p>jaxpr includes several higher-order primitives. They are more complicated because
they include sub-jaxprs.</p>
<section id="conditionals">
<h3>Conditionals<a class="headerlink" href="#conditionals" title="Link to this heading">#</a></h3>
<p>JAX traces through normal Python conditionals. To capture a
conditional expression for dynamic execution, one must use the
<a class="reference internal" href="_autosummary/jax.lax.switch.html#jax.lax.switch" title="jax.lax.switch"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.lax.switch()</span></code></a> and <a class="reference internal" href="_autosummary/jax.lax.cond.html#jax.lax.cond" title="jax.lax.cond"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.lax.cond()</span></code></a> constructors,
which have the signatures:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lax</span><span class="o">.</span><span class="n">switch</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">branches</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="p">],</span> <span class="n">operand</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">B</span>

<span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">pred</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">true_body</span><span class="p">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="p">,</span> <span class="n">false_body</span><span class="p">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="p">,</span> <span class="n">operand</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">B</span>
</pre></div>
</div>
<p>Both of these will bind a primitive called <code class="docutils literal notranslate"><span class="pre">cond</span></code> internally. The
<code class="docutils literal notranslate"><span class="pre">cond</span></code> primitive in jaxprs reflects the more general signature of
<code class="xref py py-func docutils literal notranslate"><span class="pre">lax.switch()</span></code>: it takes an integer denoting the index of the branch
to execute (clamped into valid indexing range).</p>
<p>For example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">lax</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">one_of_three</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">switch</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">,</span>
<span class="gp">... </span>                            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">,</span>
<span class="gp">... </span>                            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">3.</span><span class="p">],</span>
<span class="gp">... </span>                    <span class="n">arg</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">one_of_three</span><span class="p">)(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">5.</span><span class="p">))</span>
<span class="go">{ lambda ; a:i32[] b:f32[]. let</span>
<span class="go">    c:i32[] = convert_element_type[new_dtype=int32 weak_type=False] a</span>
<span class="go">    d:i32[] = clamp 0 c 2</span>
<span class="go">    e:f32[] = cond[</span>
<span class="go">      branches=(</span>
<span class="go">        { lambda ; f:f32[]. let g:f32[] = add f 1.0 in (g,) }</span>
<span class="go">        { lambda ; h:f32[]. let i:f32[] = sub h 2.0 in (i,) }</span>
<span class="go">        { lambda ; j:f32[]. let k:f32[] = add j 3.0 in (k,) }</span>
<span class="go">      )</span>
<span class="go">      linear=(False,)</span>
<span class="go">    ] d b</span>
<span class="go">  in (e,) }</span>
</pre></div>
</div>
<p>The cond primitive has a number of parameters:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>branches</cite> are jaxprs that correspond to the branch
functionals. In this example, those functionals each take one
input variable, corresponding to <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p></li>
<li><p><cite>linear</cite> is a tuple of booleans that is used internally by the
auto-differentiation machinery to encode which of the input
parameters are used linearly in the conditional.</p></li>
</ul>
</div></blockquote>
<p>The above instance of the cond primitive takes two operands.  The first
one (<code class="docutils literal notranslate"><span class="pre">d</span></code>) is the branch index, then <code class="docutils literal notranslate"><span class="pre">b</span></code> is the operand (<code class="docutils literal notranslate"><span class="pre">arg</span></code>) to
be passed to whichever jaxpr in <code class="docutils literal notranslate"><span class="pre">branches</span></code> is selected by the branch
index.</p>
<p>Another example, using <code class="xref py py-func docutils literal notranslate"><span class="pre">lax.cond()</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">lax</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func7</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">arg</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="k">lambda</span> <span class="n">xtrue</span><span class="p">:</span> <span class="n">xtrue</span> <span class="o">+</span> <span class="mf">3.</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="k">lambda</span> <span class="n">xfalse</span><span class="p">:</span> <span class="n">xfalse</span> <span class="o">-</span> <span class="mf">3.</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">arg</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func7</span><span class="p">)(</span><span class="mf">5.</span><span class="p">))</span>
<span class="go">{ lambda ; a:f32[]. let</span>
<span class="go">    b:bool[] = ge a 0.0</span>
<span class="go">    c:i32[] = convert_element_type[new_dtype=int32 weak_type=False] b</span>
<span class="go">    d:f32[] = cond[</span>
<span class="go">      branches=(</span>
<span class="go">        { lambda ; e:f32[]. let f:f32[] = sub e 3.0 in (f,) }</span>
<span class="go">        { lambda ; g:f32[]. let h:f32[] = add g 3.0 in (h,) }</span>
<span class="go">      )</span>
<span class="go">      linear=(False,)</span>
<span class="go">    ] c a</span>
<span class="go">  in (d,) }</span>
</pre></div>
</div>
<p>In this case, the boolean predicate is converted to an integer index
(0 or 1), and <code class="docutils literal notranslate"><span class="pre">branches</span></code> are jaxprs that correspond to the false and
true branch functionals, in that order. Again, each functional takes
one input variable, corresponding to <code class="docutils literal notranslate"><span class="pre">xfalse</span></code> and <code class="docutils literal notranslate"><span class="pre">xtrue</span></code>
respectively.</p>
<p>The following example shows a more complicated situation when the input
to the branch functionals is a tuple, and the <cite>false</cite> branch functional
contains a constant <code class="docutils literal notranslate"><span class="pre">jnp.ones(1)</span></code> that is hoisted as a <cite>constvar</cite></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func8</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>  <span class="c1"># arg2 is a pair</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">arg1</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="k">lambda</span> <span class="n">xtrue</span><span class="p">:</span> <span class="n">xtrue</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>                  <span class="k">lambda</span> <span class="n">xfalse</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">xfalse</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>                  <span class="n">arg2</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func8</span><span class="p">)(</span><span class="mf">5.</span><span class="p">,</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mf">2.</span><span class="p">)))</span>
<span class="go">{ lambda a:i32[1]; b:f32[] c:f32[1] d:f32[]. let</span>
<span class="go">    e:bool[] = ge b 0.0</span>
<span class="go">    f:i32[] = convert_element_type[new_dtype=int32 weak_type=False] e</span>
<span class="go">    g:f32[1] = cond[</span>
<span class="go">      branches=(</span>
<span class="go">        { lambda ; h:i32[1] i:f32[1] j:f32[]. let</span>
<span class="go">            k:f32[1] = convert_element_type[new_dtype=float32 weak_type=True] h</span>
<span class="go">            l:f32[1] = add k j</span>
<span class="go">          in (l,) }</span>
<span class="go">        { lambda ; m_:i32[1] n:f32[1] o:f32[]. let  in (n,) }</span>
<span class="go">      )</span>
<span class="go">      linear=(False, False, False)</span>
<span class="go">    ] f a c d</span>
<span class="go">  in (g,) }</span>
</pre></div>
</div>
</section>
<section id="while">
<h3>While<a class="headerlink" href="#while" title="Link to this heading">#</a></h3>
<p>Just like for conditionals, Python loops are inlined during tracing.
If you want to capture a loop for dynamic execution, you must use one of several
special operations, <a class="reference internal" href="_autosummary/jax.lax.while_loop.html#jax.lax.while_loop" title="jax.lax.while_loop"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.lax.while_loop()</span></code></a> (a primitive)
and <a class="reference internal" href="_autosummary/jax.lax.fori_loop.html#jax.lax.fori_loop" title="jax.lax.fori_loop"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.lax.fori_loop()</span></code></a>
(a helper that generates a while_loop primitive):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lax</span><span class="o">.</span><span class="n">while_loop</span><span class="p">(</span><span class="n">cond_fun</span><span class="p">:</span> <span class="p">(</span><span class="n">C</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">),</span> <span class="n">body_fun</span><span class="p">:</span> <span class="p">(</span><span class="n">C</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">),</span> <span class="n">init</span><span class="p">:</span> <span class="n">C</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">C</span>
<span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span> <span class="o">-&gt;</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">),</span> <span class="n">init</span><span class="p">:</span> <span class="n">C</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">C</span>
</pre></div>
</div>
<p>In the above signature, â€œCâ€ stands for the type of the loop â€œcarryâ€ value.
For example, here is an example fori loop</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func10</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="gp">... </span>  <span class="n">ones</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># A constant</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span>
<span class="gp">... </span>                       <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">carry</span><span class="p">:</span> <span class="n">carry</span> <span class="o">+</span> <span class="n">ones</span> <span class="o">*</span> <span class="mf">3.</span> <span class="o">+</span> <span class="n">arg</span><span class="p">,</span>
<span class="gp">... </span>                       <span class="n">arg</span> <span class="o">+</span> <span class="n">ones</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func10</span><span class="p">)(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span> <span class="mi">5</span><span class="p">))</span>
<span class="go">{ lambda ; a:f32[16] b:i32[]. let</span>
<span class="go">    c:f32[16] = broadcast_in_dim[broadcast_dimensions=() shape=(16,)] 1.0</span>
<span class="go">    d:f32[16] = add a c</span>
<span class="go">    _:i32[] _:i32[] e:f32[16] = while[</span>
<span class="go">      body_jaxpr={ lambda ; f:f32[16] g:f32[16] h:i32[] i:i32[] j:f32[16]. let</span>
<span class="go">          k:i32[] = add h 1</span>
<span class="go">          l:f32[16] = mul f 3.0</span>
<span class="go">          m:f32[16] = add j l</span>
<span class="go">          n:f32[16] = add m g</span>
<span class="go">        in (k, i, n) }</span>
<span class="go">      body_nconsts=2</span>
<span class="go">      cond_jaxpr={ lambda ; o:i32[] p:i32[] q:f32[16]. let</span>
<span class="go">          r:bool[] = lt o p</span>
<span class="go">        in (r,) }</span>
<span class="go">      cond_nconsts=0</span>
<span class="go">    ] c a 0 b d</span>
<span class="go">  in (e,) }</span>
</pre></div>
</div>
<p>The while primitive takes 5 arguments: <code class="docutils literal notranslate"><span class="pre">c</span> <span class="pre">a</span> <span class="pre">0</span> <span class="pre">b</span> <span class="pre">d</span></code>, as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p>0 constants for <code class="docutils literal notranslate"><span class="pre">cond_jaxpr</span></code> (since <code class="docutils literal notranslate"><span class="pre">cond_nconsts</span></code> is 0)</p></li>
<li><p>2 constants for <code class="docutils literal notranslate"><span class="pre">body_jaxpr</span></code> (<code class="docutils literal notranslate"><span class="pre">c</span></code>, and <code class="docutils literal notranslate"><span class="pre">a</span></code>)</p></li>
<li><p>3 parameters for the initial value of carry</p></li>
</ul>
</div></blockquote>
</section>
<section id="scan">
<h3>Scan<a class="headerlink" href="#scan" title="Link to this heading">#</a></h3>
<p>JAX supports a special form of loop over the elements of an array (with
statically known shape). The fact that there are a fixed number of iterations
makes this form of looping easily reverse-differentiable. Such loops are
constructed with the <a class="reference internal" href="_autosummary/jax.lax.scan.html#jax.lax.scan" title="jax.lax.scan"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.lax.scan()</span></code></a> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lax</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">body_fun</span><span class="p">:</span> <span class="p">(</span><span class="n">C</span> <span class="o">-&gt;</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">B</span><span class="p">)),</span> <span class="n">init_carry</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="n">in_arr</span><span class="p">:</span> <span class="n">Array</span><span class="p">[</span><span class="n">A</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">Array</span><span class="p">[</span><span class="n">B</span><span class="p">])</span>
</pre></div>
</div>
<p>This is written in terms of a <a class="reference external" href="https://wiki.haskell.org/Type_signature">Haskell Type Signature</a>:
<code class="docutils literal notranslate"><span class="pre">C</span></code> is the type of the scan carry, <code class="docutils literal notranslate"><span class="pre">A</span></code> is the element type of the
input array(s), and <code class="docutils literal notranslate"><span class="pre">B</span></code> is the element type of the output array(s).</p>
<p>For the example consider the function <code class="docutils literal notranslate"><span class="pre">func11</span></code> below</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func11</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">extra</span><span class="p">):</span>
<span class="gp">... </span>  <span class="n">ones</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1">#  A constant</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">body</span><span class="p">(</span><span class="n">carry</span><span class="p">,</span> <span class="n">aelems</span><span class="p">):</span>
<span class="gp">... </span>    <span class="c1"># carry: running dot-product of the two arrays</span>
<span class="gp">... </span>    <span class="c1"># aelems: a pair with corresponding elements from the two arrays</span>
<span class="gp">... </span>    <span class="n">ae1</span><span class="p">,</span> <span class="n">ae2</span> <span class="o">=</span> <span class="n">aelems</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">(</span><span class="n">carry</span> <span class="o">+</span> <span class="n">ae1</span> <span class="o">*</span> <span class="n">ae2</span> <span class="o">+</span> <span class="n">extra</span><span class="p">,</span> <span class="n">carry</span><span class="p">)</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">ones</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func11</span><span class="p">)(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span> <span class="mf">5.</span><span class="p">))</span>
<span class="go">{ lambda ; a:f32[16] b:f32[]. let</span>
<span class="go">    c:f32[16] = broadcast_in_dim[broadcast_dimensions=() shape=(16,)] 1.0</span>
<span class="go">    d:f32[] e:f32[16] = scan[</span>
<span class="go">      _split_transpose=False</span>
<span class="go">      jaxpr={ lambda ; f:f32[] g:f32[] h:f32[] i:f32[]. let</span>
<span class="go">          j:f32[] = mul h i</span>
<span class="go">          k:f32[] = convert_element_type[new_dtype=float32 weak_type=False] g</span>
<span class="go">          l:f32[] = add k j</span>
<span class="go">          m:f32[] = convert_element_type[new_dtype=float32 weak_type=False] f</span>
<span class="go">          n:f32[] = add l m</span>
<span class="go">        in (n, g) }</span>
<span class="go">      length=16</span>
<span class="go">      linear=(False, False, False, False)</span>
<span class="go">      num_carry=1</span>
<span class="go">      num_consts=1</span>
<span class="go">      reverse=False</span>
<span class="go">      unroll=1</span>
<span class="go">    ] b 0.0 a c</span>
<span class="go">  in (d, e) }</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">linear</span></code> parameter describes for each of the input variables whether they
are guaranteed to be used linearly in the body. Once the scan goes through
linearization, more arguments will be linear.</p>
<p>The scan primitive takes 4 arguments: <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">0.0</span> <span class="pre">a</span> <span class="pre">c</span></code>, of which:</p>
<blockquote>
<div><ul class="simple">
<li><p>one is the free variable for the body</p></li>
<li><p>one is the initial value of the carry</p></li>
<li><p>The next 2 are the arrays over which the scan operates.</p></li>
</ul>
</div></blockquote>
</section>
<section id="xla-call">
<h3>XLA_call<a class="headerlink" href="#xla-call" title="Link to this heading">#</a></h3>
<p>The call primitive arises from JIT compilation, and it encapsulates
a sub-jaxpr along with parameters that specify the backend and the device on
which the computation should run. For example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">jit</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func12</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
<span class="gp">... </span>  <span class="nd">@jit</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">arg</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Include a constant in the inner function</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">arg</span> <span class="o">+</span> <span class="n">inner</span><span class="p">(</span><span class="n">arg</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func12</span><span class="p">)(</span><span class="mf">1.</span><span class="p">))</span>  
<span class="go">{ lambda ; a:f32[]. let</span>
<span class="go">    b:f32[] = sub a 2.0</span>
<span class="go">    c:f32[1] = pjit[</span>
<span class="go">      name=inner</span>
<span class="go">      jaxpr={ lambda ; d:f32[] e:f32[]. let</span>
<span class="go">          f:f32[1] = broadcast_in_dim[broadcast_dimensions=() shape=(1,)] 1.0</span>
<span class="go">          g:f32[] = convert_element_type[new_dtype=float32 weak_type=False] d</span>
<span class="go">          h:f32[1] = mul g f</span>
<span class="go">          i:f32[] = convert_element_type[new_dtype=float32 weak_type=False] e</span>
<span class="go">          j:f32[1] = add i h</span>
<span class="go">        in (j,) }</span>
<span class="go">    ] a b</span>
<span class="go">    k:f32[] = convert_element_type[new_dtype=float32 weak_type=False] a</span>
<span class="go">    l:f32[1] = add k c</span>
<span class="go">  in (l,) }</span>
</pre></div>
</div>
</section>
<section id="xla-pmap">
<h3>XLA_pmap<a class="headerlink" href="#xla-pmap" title="Link to this heading">#</a></h3>
<p>If you use the <a class="reference internal" href="_autosummary/jax.pmap.html#jax.pmap" title="jax.pmap"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.pmap()</span></code></a> transformation, the function to be mapped is
captured using the <code class="docutils literal notranslate"><span class="pre">xla_pmap</span></code> primitive. Consider this example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">pmap</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func13</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">extra</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="c1"># use a free variable "extra" and a constant jnp.ones(1)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">extra</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">lax</span><span class="o">.</span><span class="n">psum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis_name</span><span class="o">=</span><span class="s1">'rows'</span><span class="p">)</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">pmap</span><span class="p">(</span><span class="n">inner</span><span class="p">,</span> <span class="n">axis_name</span><span class="o">=</span><span class="s1">'rows'</span><span class="p">)(</span><span class="n">arr</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func13</span><span class="p">)(</span><span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="mf">5.</span><span class="p">))</span>
<span class="go">{ lambda ; a:f32[1,3] b:f32[]. let</span>
<span class="go">    c:f32[1,3] = xla_pmap[</span>
<span class="go">      axis_name=rows</span>
<span class="go">      axis_size=1</span>
<span class="go">      backend=None</span>
<span class="go">      call_jaxpr={ lambda ; d:f32[] e:f32[3]. let</span>
<span class="go">          f:f32[] = convert_element_type[new_dtype=float32 weak_type=False] d</span>
<span class="go">          g:f32[3] = add e f</span>
<span class="go">          h:f32[1] = broadcast_in_dim[broadcast_dimensions=() shape=(1,)] 1.0</span>
<span class="go">          i:f32[3] = add g h</span>
<span class="go">          j:f32[3] = psum[axes=('rows',) axis_index_groups=None] e</span>
<span class="go">          k:f32[3] = div i j</span>
<span class="go">        in (k,) }</span>
<span class="go">      devices=None</span>
<span class="go">      donated_invars=(False, False)</span>
<span class="go">      global_axis_size=1</span>
<span class="go">      in_axes=(None, 0)</span>
<span class="go">      is_explicit_global_axis_size=False</span>
<span class="go">      name=inner</span>
<span class="go">      out_axes=(0,)</span>
<span class="go">    ] b a</span>
<span class="go">  in (c,) }</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">xla_pmap</span></code> primitive specifies the name of the axis (parameter
<code class="docutils literal notranslate"><span class="pre">axis_name</span></code>) and the body of the function to be mapped as the <code class="docutils literal notranslate"><span class="pre">call_jaxpr</span></code>
parameter. The value of this parameter is a Jaxpr with 2 input variables.</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">in_axes</span></code> specifies which of the input variables should be
mapped and which should be broadcast. In our example, the value of <code class="docutils literal notranslate"><span class="pre">extra</span></code>
is broadcast and the value of <code class="docutils literal notranslate"><span class="pre">arr</span></code> is mapped.</p>
</section>
</section>
</section>
</article>
<footer class="prev-next-footer">
<div class="prev-next-area">
<a class="left-prev" href="persistent_compilation_cache.html" title="previous page">
<i class="fa-solid fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">Persistent Compilation Cache</p>
</div>
</a>
<a class="right-next" href="notebooks/external_callbacks.html" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">External Callbacks in JAX</p>
</div>
<i class="fa-solid fa-angle-right"></i>
</a>
</div>
</footer>
</div>
<div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">
<div class="sidebar-secondary-item">
<div class="page-toc tocsection onthispage" id="pst-page-navigation-heading-2">
<i class="fa-solid fa-list"></i> On this page
  </div>
<nav aria-labelledby="pst-page-navigation-heading-2" class="bd-toc-nav page-toc">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-pytrees">Handling PyTrees</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constant-vars">Constant Vars</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#higher-order-primitives">Higher-order primitives</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conditionals">Conditionals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#while">While</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scan">Scan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xla-call">XLA_call</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xla-pmap">XLA_pmap</a></li>
</ul>
</li>
</ul>
</nav></div>
</div></div>
</div>
<footer class="bd-footer-content">
<div class="bd-footer-content__inner container">
<div class="footer-item">
<p class="component-author">
By The JAX authors
</p>
</div>
<div class="footer-item">
<p class="copyright">
    
      Â© Copyright 2024, The JAX Authors. NumPy and SciPy documentation are copyright the respective authors..
      <br/>
</p>
</div>
<div class="footer-item">
</div>
<div class="footer-item">
</div>
</div>
</footer>
</main>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>
<footer class="bd-footer">
</footer>
</body>
</html>