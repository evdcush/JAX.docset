
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How to Think in JAX &#8212; JAX  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=02ed413a" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/thinking_in_jax';</script>
    <link rel="icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="🔪 JAX - The Sharp Bits 🔪" href="Common_Gotchas_in_JAX.html" />
    <link rel="prev" title="JAX Quickstart" href="quickstart.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/jax_logo_250px.png" class="logo__image only-light" alt="JAX  documentation - Home"/>
    <script>document.write(`<img src="../_static/jax_logo_250px.png" class="logo__image only-dark" alt="JAX  documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installing JAX</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">JAX Quickstart</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">How to Think in JAX</a></li>
<li class="toctree-l1"><a class="reference internal" href="Common_Gotchas_in_JAX.html">🔪 JAX - The Sharp Bits 🔪</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">JAX Frequently Asked Questions (FAQ)</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../jax-101/index.html">Tutorial: JAX 101</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../jax-101/01-jax-basics.html">JAX As Accelerated NumPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax-101/02-jitting.html">Just In Time Compilation with JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax-101/03-vectorization.html">Automatic Vectorization in JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax-101/04-advanced-autodiff.html">Advanced Automatic Differentiation in JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax-101/05-random-numbers.html">Pseudo Random Numbers in JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax-101/05.1-pytrees.html">Working with Pytrees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax-101/06-parallelism.html">Parallel Evaluation in JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax-101/07-state.html">Stateful Computations in JAX</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Further Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../user_guides.html">User Guides</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../profiling.html">Profiling JAX programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_memory_profiling.html">Device Memory Profiling</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../debugging/index.html">Runtime value debugging in JAX</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../debugging/print_breakpoint.html"><code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> and <code class="docutils literal notranslate"><span class="pre">jax.debug.breakpoint</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../debugging/checkify_guide.html">The <code class="docutils literal notranslate"><span class="pre">checkify</span></code> transformation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../debugging/flags.html">JAX debugging flags</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../gpu_performance_tips.html">GPU performance tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../persistent_compilation_cache.html">Persistent Compilation Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jaxpr.html">Understanding Jaxprs</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_callbacks.html">External Callbacks in JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../type_promotion.html">Type promotion semantics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pytrees.html">Pytrees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../aot.html">Ahead-of-time lowering and compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../errors.html">JAX Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../transfer_guard.html">Transfer guard</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../pallas/index.html">Pallas: a JAX kernel language</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../pallas/design.html">Pallas Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pallas/quickstart.html">Pallas Quickstart</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../pallas/tpu/index.html">Pallas TPU</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../pallas/tpu/details.html">Writing TPU kernels with Pallas</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pallas/tpu/pipelining.html">Pipelining and <code class="docutils literal notranslate"><span class="pre">BlockSpec</span></code>s</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../advanced_guide.html">Advanced Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="neural_network_with_tfds_data.html">Training a Simple Neural Network, with tensorflow/datasets Data Loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="Neural_Network_and_Data_Loading.html">Training a Simple Neural Network, with PyTorch Data Loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmapped_log_probs.html">Autobatching for Bayesian Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multi_process.html">Using JAX in multi-host and multi-process environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="Distributed_arrays_and_automatic_parallelization.html">Distributed arrays and automatic parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="shard_map.html">SPMD multi-device parallelism with <code class="docutils literal notranslate"><span class="pre">shard_map</span></code></a></li>



<li class="toctree-l2"><a class="reference internal" href="xmap_tutorial.html">Named axes and easy-to-revise parallelism with <code class="docutils literal notranslate"><span class="pre">xmap</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="autodiff_cookbook.html">The Autodiff Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="Custom_derivative_rules_for_Python_code.html">Custom derivative rules for JAX-transformable Python functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="autodiff_remat.html">Control autodiff’s saved values with <code class="docutils literal notranslate"><span class="pre">jax.checkpoint</span></code> (aka <code class="docutils literal notranslate"><span class="pre">jax.remat</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="How_JAX_primitives_work.html">How JAX primitives work</a></li>
<li class="toctree-l2"><a class="reference internal" href="Writing_custom_interpreters_in_Jax.html">Writing custom Jaxpr interpreters in JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Custom_Operation_for_GPUs.html">Custom operations for GPUs with C++ and CUDA</a></li>

<li class="toctree-l2"><a class="reference internal" href="convolutions.html">Generalized Convolutions in JAX</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contributor_guide.html">Developer Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html">Contributing to JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer.html">Building from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax_internal_api.html">Internal APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../autodidax.html">Autodidax: JAX core from scratch</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../jep/index.html">JAX Enhancement Proposals (JEPs)</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../jep/263-prng.html">263: JAX PRNG Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jep/2026-custom-derivatives.html">2026: Custom JVP/VJP rules for JAX-transformable functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jep/4008-custom-vjp-update.html">4008: Custom VJP and `nondiff_argnums` update</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jep/4410-omnistaging.html">4410: Omnistaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jep/9263-typed-keys.html">9263: Typed keys &amp; pluggable RNGs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jep/9407-type-promotion.html">9407: Design of Type Promotion Semantics for JAX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jep/9419-jax-versioning.html">9419: Jax and Jaxlib versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jep/10657-sequencing-effects.html">10657: Sequencing side-effects in JAX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jep/11830-new-remat-checkpoint.html">11830: `jax.remat` / `jax.checkpoint` new implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jep/12049-type-annotations.html">12049: Type Annotation Roadmap for JAX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jep/14273-shard-map.html">14273: `shard_map` (`shmap`) for simple per-device code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jep/15856-jex.html">15856: `jax.extend`, an extensions module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jep/17111-shmap-transpose.html">17111: Efficient transposition of `shard_map` (and other maps)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jep/18137-numpy-scipy-scope.html">18137: Scope of JAX NumPy &amp; SciPy Wrappers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../investigating_a_regression.html">Investigating a regression</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../building_on_jax.html">Building on JAX</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../notes.html">Notes</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_compatibility.html">API compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deprecation.html">Python and NumPy version support policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax_array_migration.html">jax.Array migration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../async_dispatch.html">Asynchronous dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concurrency.html">Concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpu_memory_allocation.html">GPU memory allocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rank_promotion_warning.html">Rank promotion warning</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../jax.html">Public API: jax package</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../jax.numpy.html"><code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.fft.html">jax.numpy.fft.fft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.fft2.html">jax.numpy.fft.fft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.fftfreq.html">jax.numpy.fft.fftfreq</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.fftn.html">jax.numpy.fft.fftn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.fftshift.html">jax.numpy.fft.fftshift</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.hfft.html">jax.numpy.fft.hfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.ifft.html">jax.numpy.fft.ifft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.ifft2.html">jax.numpy.fft.ifft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.ifftn.html">jax.numpy.fft.ifftn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.ifftshift.html">jax.numpy.fft.ifftshift</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.ihfft.html">jax.numpy.fft.ihfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.irfft.html">jax.numpy.fft.irfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.irfft2.html">jax.numpy.fft.irfft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.irfftn.html">jax.numpy.fft.irfftn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.rfft.html">jax.numpy.fft.rfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.rfft2.html">jax.numpy.fft.rfft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.rfftfreq.html">jax.numpy.fft.rfftfreq</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.rfftn.html">jax.numpy.fft.rfftn</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../jax.scipy.html"><code class="docutils literal notranslate"><span class="pre">jax.scipy</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.scipy.stats.bernoulli.logpmf.html">jax.scipy.stats.bernoulli.logpmf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.scipy.stats.bernoulli.pmf.html">jax.scipy.stats.bernoulli.pmf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.scipy.stats.bernoulli.cdf.html">jax.scipy.stats.bernoulli.cdf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.scipy.stats.bernoulli.ppf.html">jax.scipy.stats.bernoulli.ppf</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../jax.lax.html"><code class="docutils literal notranslate"><span class="pre">jax.lax</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.random.html"><code class="docutils literal notranslate"><span class="pre">jax.random</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.sharding.html"><code class="docutils literal notranslate"><span class="pre">jax.sharding</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.debug.html"><code class="docutils literal notranslate"><span class="pre">jax.debug</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.dlpack.html"><code class="docutils literal notranslate"><span class="pre">jax.dlpack</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.distributed.html"><code class="docutils literal notranslate"><span class="pre">jax.distributed</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.dtypes.html"><code class="docutils literal notranslate"><span class="pre">jax.dtypes</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.flatten_util.html"><code class="docutils literal notranslate"><span class="pre">jax.flatten_util</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.image.html"><code class="docutils literal notranslate"><span class="pre">jax.image</span></code> module</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../jax.nn.html"><code class="docutils literal notranslate"><span class="pre">jax.nn</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../jax.nn.initializers.html"><code class="docutils literal notranslate"><span class="pre">jax.nn.initializers</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../jax.ops.html"><code class="docutils literal notranslate"><span class="pre">jax.ops</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.profiler.html"><code class="docutils literal notranslate"><span class="pre">jax.profiler</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.stages.html"><code class="docutils literal notranslate"><span class="pre">jax.stages</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.tree.html"><code class="docutils literal notranslate"><span class="pre">jax.tree</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.tree_util.html"><code class="docutils literal notranslate"><span class="pre">jax.tree_util</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.typing.html"><code class="docutils literal notranslate"><span class="pre">jax.typing</span></code> module</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../jax.extend.html"><code class="docutils literal notranslate"><span class="pre">jax.extend</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../jax.extend.linear_util.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.linear_util</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.extend.mlir.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.mlir</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.extend.random.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.random</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../jax.example_libraries.html"><code class="docutils literal notranslate"><span class="pre">jax.example_libraries</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../jax.example_libraries.optimizers.html"><code class="docutils literal notranslate"><span class="pre">jax.example_libraries.optimizers</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.example_libraries.stax.html"><code class="docutils literal notranslate"><span class="pre">jax.example_libraries.stax</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../jax.experimental.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.array_api.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.array_api</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.checkify.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.checkify</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.host_callback.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.host_callback</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.maps.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.maps</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.pjit.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.pjit</span></code> module</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../jax.experimental.sparse.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.sparse</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.BCOO.html">jax.experimental.sparse.BCOO</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_broadcast_in_dim.html">jax.experimental.sparse.bcoo_broadcast_in_dim</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_concatenate.html">jax.experimental.sparse.bcoo_concatenate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_dot_general.html">jax.experimental.sparse.bcoo_dot_general</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_dot_general_sampled.html">jax.experimental.sparse.bcoo_dot_general_sampled</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_dynamic_slice.html">jax.experimental.sparse.bcoo_dynamic_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_extract.html">jax.experimental.sparse.bcoo_extract</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_fromdense.html">jax.experimental.sparse.bcoo_fromdense</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_gather.html">jax.experimental.sparse.bcoo_gather</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_multiply_dense.html">jax.experimental.sparse.bcoo_multiply_dense</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_multiply_sparse.html">jax.experimental.sparse.bcoo_multiply_sparse</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_update_layout.html">jax.experimental.sparse.bcoo_update_layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_reduce_sum.html">jax.experimental.sparse.bcoo_reduce_sum</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_reshape.html">jax.experimental.sparse.bcoo_reshape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_slice.html">jax.experimental.sparse.bcoo_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_sort_indices.html">jax.experimental.sparse.bcoo_sort_indices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_squeeze.html">jax.experimental.sparse.bcoo_squeeze</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_sum_duplicates.html">jax.experimental.sparse.bcoo_sum_duplicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_todense.html">jax.experimental.sparse.bcoo_todense</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_transpose.html">jax.experimental.sparse.bcoo_transpose</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.jet.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.jet</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.custom_partitioning.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.custom_partitioning</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.multihost_utils.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.multihost_utils</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.compilation_cache.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.compilation_cache</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.key_reuse.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.key_reuse</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.mesh_utils.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.mesh_utils</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../jax.lib.html"><code class="docutils literal notranslate"><span class="pre">jax.lib</span></code> module</a></li>
</ul>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Change log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">JAX Glossary of Terms</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/google/jax" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/thinking_in_jax.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>How to Think in JAX</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jax-vs-numpy">JAX vs. NumPy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numpy-lax-xla-jax-api-layering">NumPy, lax &amp; XLA: JAX API layering</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#to-jit-or-not-to-jit">To JIT or not to JIT</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jit-mechanics-tracing-and-static-variables">JIT mechanics: tracing and static variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#static-vs-traced-operations">Static vs Traced Operations</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="how-to-think-in-jax">
<h1>How to Think in JAX<a class="headerlink" href="#how-to-think-in-jax" title="Link to this heading">#</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/github/google/jax/blob/main/docs/notebooks/thinking_in_jax.ipynb"><img alt="Open in Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a> <a class="reference external" href="https://kaggle.com/kernels/welcome?src=https://github.com/google/jax/blob/main/docs/notebooks/thinking_in_jax.ipynb"><img alt="Open in Kaggle" src="https://kaggle.com/static/images/open-in-kaggle.svg" /></a></p>
<p>JAX provides a simple and powerful API for writing accelerated numerical code, but working effectively in JAX sometimes requires extra consideration. This document is meant to help build a ground-up understanding of how JAX operates, so that you can use it more effectively.</p>
<section id="jax-vs-numpy">
<h2>JAX vs. NumPy<a class="headerlink" href="#jax-vs-numpy" title="Link to this heading">#</a></h2>
<p><strong>Key Concepts:</strong></p>
<ul class="simple">
<li><p>JAX provides a NumPy-inspired interface for convenience.</p></li>
<li><p>Through duck-typing, JAX arrays can often be used as drop-in replacements of NumPy arrays.</p></li>
<li><p>Unlike NumPy arrays, JAX arrays are always immutable.</p></li>
</ul>
<p>NumPy provides a well-known, powerful API for working with numerical data. For convenience, JAX provides <code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code> which closely mirrors the numpy API and provides easy entry into JAX. Almost anything that can be done with <code class="docutils literal notranslate"><span class="pre">numpy</span></code> can be done with <code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">x_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">y_np</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_np</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_np</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_np</span><span class="p">,</span> <span class="n">y_np</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><img alt="../_images/75c6f5221479f5438bd4027fc2a073973120a0c097749d3eec8603253c3d729a.png" src="../_images/75c6f5221479f5438bd4027fc2a073973120a0c097749d3eec8603253c3d729a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>

<span class="n">x_jnp</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">y_jnp</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_jnp</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_jnp</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_jnp</span><span class="p">,</span> <span class="n">y_jnp</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>An NVIDIA GPU may be present on this machine, but a CUDA-enabled jaxlib is not installed. Falling back to cpu.
</pre></div>
</div>
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><img alt="../_images/c4c8ae1471a7af895f4a3ef289a5f377b179ecd01642447d013c9d7f57d23caf.png" src="../_images/c4c8ae1471a7af895f4a3ef289a5f377b179ecd01642447d013c9d7f57d23caf.png" />
</div>
</div>
<p>The code blocks are identical aside from replacing <code class="docutils literal notranslate"><span class="pre">np</span></code> with <code class="docutils literal notranslate"><span class="pre">jnp</span></code>, and the results are the same. As we can see, JAX arrays can often be used directly in place of NumPy arrays for things like plotting.</p>
<p>The arrays themselves are implemented as different Python types:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">x_np</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">&lt;class</span> <span class=" -Color -Color-Green">&#39;numpy.ndarray&#39;</span><span class=" -Color -Color-Bold">&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">x_jnp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">&lt;class</span> <span class=" -Color -Color-Green">&#39;jaxlib.xla_extension.ArrayImpl&#39;</span><span class=" -Color -Color-Bold">&gt;</span>
</pre></div>
</div>
</div>
</div>
<p>Python’s <a class="reference external" href="https://en.wikipedia.org/wiki/Duck_typing">duck-typing</a> allows JAX arrays and NumPy arrays to be used interchangeably in many places.</p>
<p>However, there is one important difference between JAX and NumPy arrays: JAX arrays are immutable, meaning that once created their contents cannot be changed.</p>
<p>Here is an example of mutating an array in NumPy:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NumPy: mutable arrays</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10  1  2  3  4  5  6  7  8  9]
</pre></div>
</div>
</div>
</div>
<p>The equivalent in JAX results in an error, as JAX arrays are immutable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">xmode</span> minimal
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Exception reporting mode: Minimal
</pre></div>
</div>
</div>
</div>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># JAX: immutable arrays</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800000; text-decoration-color: #800000">╭─────────────────────────────── </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">Traceback </span><span style="color: #bf7f7f; text-decoration-color: #bf7f7f; font-weight: bold">(most recent call last)</span><span style="color: #800000; text-decoration-color: #800000"> ────────────────────────────────╮</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">&lt;module&gt;</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">3</span>                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1 # JAX: immutable arrays</span>                                                                      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2 </span>x = jnp.arange(<span style="color: #0000ff; text-decoration-color: #0000ff">10</span>)                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>3 x[<span style="color: #0000ff; text-decoration-color: #0000ff">0</span>] = <span style="color: #0000ff; text-decoration-color: #0000ff">10</span>                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4 </span>                                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/numpy/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">array_me</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">thods.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">278</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_unimplemented_setitem</span>                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">275 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │    </span><span style="color: #808000; text-decoration-color: #808000">"immutable. Instead of ``x[idx] = y``, use ``x = x.at[idx].set(y)`` "</span>             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">276 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │    </span><span style="color: #808000; text-decoration-color: #808000">"or another .at[] method: "</span>                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">277 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │    </span><span style="color: #808000; text-decoration-color: #808000">"https://jax.readthedocs.io/en/latest/_autosummary/jax.numpy.ndarray.at.html"</span>)    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>278 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">raise</span> <span style="color: #00ffff; text-decoration-color: #00ffff">TypeError</span>(msg.format(<span style="color: #00ffff; text-decoration-color: #00ffff">type</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>)))                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">279 </span>                                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">280 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_operator_round</span>(number: ArrayLike, ndigits: <span style="color: #00ffff; text-decoration-color: #00ffff">int</span> | <span style="color: #0000ff; text-decoration-color: #0000ff">None</span> = <span style="color: #0000ff; text-decoration-color: #0000ff">None</span>) -&gt; Array:               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">281 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>out = lax_numpy.round(number, decimals=ndigits <span style="color: #ff00ff; text-decoration-color: #ff00ff">or</span> <span style="color: #0000ff; text-decoration-color: #0000ff">0</span>)                                     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">╰──────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
<span style="color: #ff0000; text-decoration-color: #ff0000; font-weight: bold">TypeError: </span><span style="color: #008000; text-decoration-color: #008000">'&lt;class '</span><span style="color: #000000; text-decoration-color: #000000">jaxlib.xla_extension.ArrayImpl'</span><span style="font-weight: bold">&gt;</span>' object does not support item assignment. JAX arrays are 
immutable. Instead of ``x<span style="font-weight: bold">[</span>idx<span style="font-weight: bold">]</span> = y``, use ``x = x.at<span style="font-weight: bold">[</span>idx<span style="font-weight: bold">]</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">.set</span><span style="font-weight: bold">(</span>y<span style="font-weight: bold">)</span>`` or another .at<span style="font-weight: bold">[]</span> method: 
<span style="color: #0000ff; text-decoration-color: #0000ff; text-decoration: underline">https://jax.readthedocs.io/en/latest/_autosummary/jax.numpy.ndarray.at.html</span>
</pre>
</div></div>
</div>
<p>For updating individual elements, JAX provides an <a class="reference external" href="https://jax.readthedocs.io/en/latest/jax.ops.html#indexed-update-operators">indexed update syntax</a> that returns an updated copy:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0 1 2 3 4 5 6 7 8 9]
[10  1  2  3  4  5  6  7  8  9]
</pre></div>
</div>
</div>
</div>
</section>
<section id="numpy-lax-xla-jax-api-layering">
<h2>NumPy, lax &amp; XLA: JAX API layering<a class="headerlink" href="#numpy-lax-xla-jax-api-layering" title="Link to this heading">#</a></h2>
<p><strong>Key Concepts:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code> is a high-level wrapper that provides a familiar interface.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jax.lax</span></code> is a lower-level API that is stricter and often more powerful.</p></li>
<li><p>All JAX operations are implemented in terms of operations in <a class="reference external" href="https://www.tensorflow.org/xla/">XLA</a> – the Accelerated Linear Algebra compiler.</p></li>
</ul>
<p>If you look at the source of <code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code>, you’ll see that all the operations are eventually expressed in terms of functions defined in <code class="docutils literal notranslate"><span class="pre">jax.lax</span></code>. You can think of <code class="docutils literal notranslate"><span class="pre">jax.lax</span></code> as a stricter, but often more powerful, API for working with multi-dimensional arrays.</p>
<p>For example, while <code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code> will implicitly promote arguments to allow operations between mixed data types, <code class="docutils literal notranslate"><span class="pre">jax.lax</span></code> will not:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="n">jnp</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># jax.numpy API implicitly promotes mixed types.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Magenta">Array</span><span class=" -Color -Color-Bold">(</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">2</span>., <span class=" -Color -Color-Yellow">dtype</span>=<span class=" -Color -Color-Magenta">float32</span>, <span class=" -Color -Color-Yellow">weak_type</span>=True<span class=" -Color -Color-Bold">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">lax</span>
<span class="n">lax</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># jax.lax API requires explicit type promotion.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800000; text-decoration-color: #800000">╭─────────────────────────────── </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">Traceback </span><span style="color: #bf7f7f; text-decoration-color: #bf7f7f; font-weight: bold">(most recent call last)</span><span style="color: #800000; text-decoration-color: #800000"> ────────────────────────────────╮</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/interpreters/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">m</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">lir.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">989</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">lower_jaxpr_to_module</span>                                                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 986 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>result_layouts=result_layouts)                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 987 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 988 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">try</span>:                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 989 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> <span style="color: #ff00ff; text-decoration-color: #ff00ff">not</span> ctx.module.operation.verify():                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 990 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">raise</span> <span style="color: #00ffff; text-decoration-color: #00ffff">ValueError</span>(                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 991 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │     </span><span style="color: #808000; text-decoration-color: #808000">"Cannot lower jaxpr with verifier errors."</span> +                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 992 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │     </span>dump_module_message(ctx.module, <span style="color: #808000; text-decoration-color: #808000">"verification"</span>))                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">╰──────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
<span style="color: #ff0000; text-decoration-color: #ff0000; font-weight: bold">MLIRError: </span>Verification failed:
error: <span style="color: #008000; text-decoration-color: #008000">"jit(add)/jit(main)/add"</span><span style="font-weight: bold">(</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"&lt;module&gt;"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/tmp/ipykernel_176355/3435837498.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">2:0</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_code"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPyt</span>
<span style="color: #008000; text-decoration-color: #008000">hon/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3577:20</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_ast_nodes"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages</span>
<span style="color: #008000; text-decoration-color: #008000">/IPython/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3517:19</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_cell_async"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-package</span>
<span style="color: #008000; text-decoration-color: #008000">s/IPython/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3334:29</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"_pseudo_sync_runner"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPython/co</span>
<span style="color: #008000; text-decoration-color: #008000">re/async_helpers.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">129:8</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell._run_cell"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPy</span>
<span style="color: #008000; text-decoration-color: #008000">thon/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3130:21</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_cell"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPyt</span>
<span style="color: #008000; text-decoration-color: #008000">hon/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3075:21</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"ZMQInteractiveShell.run_cell"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/i</span>
<span style="color: #008000; text-decoration-color: #008000">pykernel/zmqshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">549:15</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"IPythonKernel.do_execute"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/ipyke</span>
<span style="color: #008000; text-decoration-color: #008000">rnel/ipkernel.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">449:26</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #008000; text-decoration-color: #008000">"Kernel.execute_request"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/ipykernel/kernel</span>
<span style="color: #008000; text-decoration-color: #008000">base.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">778:28</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)))))))))))</span><span style="color: #000000; text-decoration-color: #000000">: </span><span style="color: #008000; text-decoration-color: #008000">'stablehlo.add'</span><span style="color: #000000; text-decoration-color: #000000"> op requires compatible types for all operands and results</span>
<span style="color: #000000; text-decoration-color: #000000"> note: </span><span style="color: #008000; text-decoration-color: #008000">"jit(add)/jit(main)/add"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"&lt;module&gt;"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/tmp/ipykernel_176355/3435837498.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">2:0</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_code"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPyt</span>
<span style="color: #008000; text-decoration-color: #008000">hon/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3577:20</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_ast_nodes"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages</span>
<span style="color: #008000; text-decoration-color: #008000">/IPython/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3517:19</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_cell_async"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-package</span>
<span style="color: #008000; text-decoration-color: #008000">s/IPython/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3334:29</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"_pseudo_sync_runner"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPython/co</span>
<span style="color: #008000; text-decoration-color: #008000">re/async_helpers.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">129:8</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell._run_cell"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPy</span>
<span style="color: #008000; text-decoration-color: #008000">thon/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3130:21</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_cell"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPyt</span>
<span style="color: #008000; text-decoration-color: #008000">hon/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3075:21</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"ZMQInteractiveShell.run_cell"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/i</span>
<span style="color: #008000; text-decoration-color: #008000">pykernel/zmqshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">549:15</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"IPythonKernel.do_execute"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/ipyke</span>
<span style="color: #008000; text-decoration-color: #008000">rnel/ipkernel.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">449:26</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #008000; text-decoration-color: #008000">"Kernel.execute_request"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/ipykernel/kernel</span>
<span style="color: #008000; text-decoration-color: #008000">base.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">778:28</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)))))))))))</span><span style="color: #000000; text-decoration-color: #000000">: see current operation: %</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span><span style="color: #000000; text-decoration-color: #000000"> = </span><span style="color: #008000; text-decoration-color: #008000">"stablehlo.add"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #000000; text-decoration-color: #000000">%arg0, %arg1</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> : </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #000000; text-decoration-color: #000000">tensor&lt;i32&gt;, tensor&lt;f32&gt;</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> </span>
<span style="color: #000000; text-decoration-color: #000000">-&gt; tensor&lt;i32</span><span style="font-weight: bold">&gt;</span>

<span style="font-style: italic">The above exception was the direct cause of the following exception:</span>

<span style="color: #800000; text-decoration-color: #800000">╭─────────────────────────────── </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">Traceback </span><span style="color: #bf7f7f; text-decoration-color: #bf7f7f; font-weight: bold">(most recent call last)</span><span style="color: #800000; text-decoration-color: #800000"> ────────────────────────────────╮</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">&lt;module&gt;</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">2</span>                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1 </span><span style="color: #0000ff; text-decoration-color: #0000ff">from</span> <span style="color: #00ffff; text-decoration-color: #00ffff; text-decoration: underline">jax</span> <span style="color: #0000ff; text-decoration-color: #0000ff">import</span> lax                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>2 lax.add(<span style="color: #0000ff; text-decoration-color: #0000ff">1</span>, <span style="color: #0000ff; text-decoration-color: #0000ff">1.0</span>)  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># jax.lax API requires explicit type promotion.</span>                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">3 </span>                                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/lax/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">lax.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">419</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">add</span>                                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 416 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 417 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">add</span>(x: ArrayLike, y: ArrayLike) -&gt; Array:                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 418 </span><span style="color: #bfbfbf; text-decoration-color: #bfbfbf">  </span><span style="color: #808000; text-decoration-color: #808000">r"""Elementwise addition: :math:`x + y`."""</span>                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 419 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> add_p.bind(x, y)                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 420 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 421 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">sub</span>(x: ArrayLike, y: ArrayLike) -&gt; Array:                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 422 </span><span style="color: #bfbfbf; text-decoration-color: #bfbfbf">  </span><span style="color: #808000; text-decoration-color: #808000">r"""Elementwise subtraction: :math:`x - y`."""</span>                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">core.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">422</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">bind</span>                                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 419 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">bind</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, *args, **params):                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 420 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">assert</span> (<span style="color: #ff00ff; text-decoration-color: #ff00ff">not</span> config.enable_checks.value <span style="color: #ff00ff; text-decoration-color: #ff00ff">or</span>                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 421 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   </span><span style="color: #00ffff; text-decoration-color: #00ffff">all</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">isinstance</span>(arg, Tracer) <span style="color: #ff00ff; text-decoration-color: #ff00ff">or</span> valid_jaxtype(arg) <span style="color: #0000ff; text-decoration-color: #0000ff">for</span> arg <span style="color: #ff00ff; text-decoration-color: #ff00ff">in</span> args)), args     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 422 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> <span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.bind_with_trace(find_top_trace(args), args, params)                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 423 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 424 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">bind_with_trace</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, trace, args, params):                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 425 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>out = trace.process_primitive(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, <span style="color: #00ffff; text-decoration-color: #00ffff">map</span>(trace.full_raise, args), params)              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">core.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">425</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">bind_with_trace</span>                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 422 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> <span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.bind_with_trace(find_top_trace(args), args, params)                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 423 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 424 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">bind_with_trace</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, trace, args, params):                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 425 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>out = trace.process_primitive(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, <span style="color: #00ffff; text-decoration-color: #00ffff">map</span>(trace.full_raise, args), params)              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 426 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> <span style="color: #00ffff; text-decoration-color: #00ffff">map</span>(full_lower, out) <span style="color: #0000ff; text-decoration-color: #0000ff">if</span> <span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.multiple_results <span style="color: #0000ff; text-decoration-color: #0000ff">else</span> full_lower(out)             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 427 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 428 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">def_impl</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, impl):                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">core.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">913</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">process_primitive</span>                                                                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 910 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>lift = sublift = pure                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 911 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 912 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">process_primitive</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, primitive, tracers, params):                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 913 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> primitive.impl(*tracers, **params)                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 914 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 915 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">process_call</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, primitive, f, tracers, params):                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 916 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> primitive.impl(f, *tracers, **params)                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">dispatch.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">87</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">apply_primitive</span>                                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 84 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> xla_extension_version &gt;= <span style="color: #0000ff; text-decoration-color: #0000ff">218</span>:                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 85 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>prev = lib.jax_jit.swap_thread_local_state_disable_jit(<span style="color: #0000ff; text-decoration-color: #0000ff">False</span>)                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 86 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">try</span>:                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 87 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>outs = fun(*args)                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 88 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">finally</span>:                                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 89 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>lib.jax_jit.swap_thread_local_state_disable_jit(prev)                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 90 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">else</span>:                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">traceback_util</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">179</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">reraise_with_filtered_traceback</span>                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">176 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">reraise_with_filtered_traceback</span>(*args, **kwargs):                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">177 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>__tracebackhide__ = <span style="color: #0000ff; text-decoration-color: #0000ff">True</span>                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">178 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">try</span>:                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>179 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> fun(*args, **kwargs)                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">180 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">except</span> <span style="color: #00ffff; text-decoration-color: #00ffff">Exception</span> <span style="color: #0000ff; text-decoration-color: #0000ff">as</span> e:                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">181 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>mode = _filtering_mode()                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">182 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> _is_under_reraiser(e) <span style="color: #ff00ff; text-decoration-color: #ff00ff">or</span> mode == <span style="color: #808000; text-decoration-color: #808000">"off"</span>:                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">298</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">cache_miss</span>                                                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 295 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 296 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">@api_boundary</span>                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 297 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">cache_miss</span>(*args, **kwargs):                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 298 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>outs, out_flat, out_tree, args_flat, jaxpr, attrs_tracked = _python_pjit_helper(      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 299 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>jit_info, *args, **kwargs)                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 300 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>executable = _read_most_recent_pjit_call_executable(jaxpr)                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 301 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>maybe_fastpath_data = _get_fastpath_data(                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">176</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_python_pjit_helper</span>                                                                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 173 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>args_flat = [*init_states, *args_flat]                                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 174 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 175 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">try</span>:                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 176 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>out_flat = pjit_p.bind(*args_flat, **params)                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 177 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">except</span> pxla.DeviceAssignmentMismatchError <span style="color: #0000ff; text-decoration-color: #0000ff">as</span> e:                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 178 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>fails, = e.args                                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 179 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>api_name = <span style="color: #808000; text-decoration-color: #808000">'jit'</span> <span style="color: #0000ff; text-decoration-color: #0000ff">if</span> params[<span style="color: #808000; text-decoration-color: #808000">'resource_env'</span>] <span style="color: #ff00ff; text-decoration-color: #ff00ff">is</span> <span style="color: #0000ff; text-decoration-color: #0000ff">None</span> <span style="color: #0000ff; text-decoration-color: #0000ff">else</span> <span style="color: #808000; text-decoration-color: #808000">'pjit'</span>                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">core.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">2788</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">bind</span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2785 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   │   </span>default=<span style="color: #0000ff; text-decoration-color: #0000ff">None</span>, key=<span style="color: #0000ff; text-decoration-color: #0000ff">lambda</span> t: <span style="color: #00ffff; text-decoration-color: #00ffff">getattr</span>(t, <span style="color: #808000; text-decoration-color: #808000">'level'</span>, -<span style="color: #0000ff; text-decoration-color: #0000ff">1</span>))                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2786 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>top_trace = (top_trace <span style="color: #0000ff; text-decoration-color: #0000ff">if</span> <span style="color: #ff00ff; text-decoration-color: #ff00ff">not</span> axis_main <span style="color: #ff00ff; text-decoration-color: #ff00ff">or</span> axis_main.level &lt; top_trace.level          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2787 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │    </span><span style="color: #0000ff; text-decoration-color: #0000ff">else</span> axis_main.with_cur_sublevel())                                      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>2788 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> <span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.bind_with_trace(top_trace, args, params)                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2789 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2790 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2791 # ------------------- Jaxpr checking -------------------</span>                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">core.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">425</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">bind_with_trace</span>                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 422 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> <span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.bind_with_trace(find_top_trace(args), args, params)                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 423 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 424 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">bind_with_trace</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, trace, args, params):                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 425 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>out = trace.process_primitive(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, <span style="color: #00ffff; text-decoration-color: #00ffff">map</span>(trace.full_raise, args), params)              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 426 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> <span style="color: #00ffff; text-decoration-color: #00ffff">map</span>(full_lower, out) <span style="color: #0000ff; text-decoration-color: #0000ff">if</span> <span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.multiple_results <span style="color: #0000ff; text-decoration-color: #0000ff">else</span> full_lower(out)             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 427 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 428 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">def_impl</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, impl):                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">core.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">913</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">process_primitive</span>                                                                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 910 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>lift = sublift = pure                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 911 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 912 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">process_primitive</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, primitive, tracers, params):                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 913 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> primitive.impl(*tracers, **params)                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 914 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 915 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">process_call</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, primitive, f, tracers, params):                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 916 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> primitive.impl(f, *tracers, **params)                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1488</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_pjit_call_impl</span>                                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1485 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>has_explicit_sharding = _pjit_explicit_sharding(                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1486 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>in_shardings, out_shardings, <span style="color: #0000ff; text-decoration-color: #0000ff">None</span>, <span style="color: #0000ff; text-decoration-color: #0000ff">None</span>)                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1487 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> xla_extension_version &gt;= <span style="color: #0000ff; text-decoration-color: #0000ff">226</span>:                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1488 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> xc._xla.pjit(                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1489 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>name, f, call_impl_cache_miss, [], [], donated_argnums,                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1490 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>tree_util.dispatch_registry,                                                      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1491 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>pxla.shard_arg <span style="color: #0000ff; text-decoration-color: #0000ff">if</span> xla_extension_version &gt;= <span style="color: #0000ff; text-decoration-color: #0000ff">229</span> <span style="color: #0000ff; text-decoration-color: #0000ff">else</span> pxla.temp_shard_arg,  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># type</span>  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1471</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">call_impl_cache_miss</span>                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1468 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   │   </span>in_shardings, out_shardings, resource_env,                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1469 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   │   </span>donated_invars, name, keep_unused, inline):                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1470 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">call_impl_cache_miss</span>(*args_, **kwargs_):                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1471 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>out_flat, compiled = _pjit_call_impl_python(                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1472 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>*args, jaxpr=jaxpr, in_shardings=in_shardings,                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1473 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>out_shardings=out_shardings, resource_env=resource_env,                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1474 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>donated_invars=donated_invars, name=name, keep_unused=keep_unused,                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1403</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_pjit_call_impl_python</span>                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1400 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>args, in_shardings, out_shardings,                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1401 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>resource_env.physical_mesh <span style="color: #0000ff; text-decoration-color: #0000ff">if</span> resource_env <span style="color: #ff00ff; text-decoration-color: #ff00ff">is</span> <span style="color: #ff00ff; text-decoration-color: #ff00ff">not</span> <span style="color: #0000ff; text-decoration-color: #0000ff">None</span> <span style="color: #0000ff; text-decoration-color: #0000ff">else</span> <span style="color: #0000ff; text-decoration-color: #0000ff">None</span>)                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1402 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1403 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>compiled = _pjit_lower(                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1404 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>jaxpr, in_shardings, out_shardings, resource_env,                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1405 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>donated_invars, name, keep_unused, inline,                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1406 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>lowering_parameters=mlir.LoweringParameters()).compile()                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1502</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_pjit_lower</span>                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1499 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1500 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1501 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_pjit_lower</span>(*args, **kwargs):                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1502 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> _pjit_lower_cached(*args, **kwargs)                                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1503 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1504 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1505 </span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">@weakref_lru_cache</span>                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1546</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_pjit_lower_cached</span>                                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1543 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">True</span>, jaxpr.in_avals, tiling_method=<span style="color: #0000ff; text-decoration-color: #0000ff">None</span>,                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1544 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>lowering_parameters=lowering_parameters)                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1545 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">else</span>:                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1546 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> pxla.lower_sharding_computation(                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1547 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>jaxpr, api_name, name, in_shardings, out_shardings,                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1548 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span><span style="color: #00ffff; text-decoration-color: #00ffff">tuple</span>(donated_invars), <span style="color: #00ffff; text-decoration-color: #00ffff">tuple</span>(jaxpr.in_avals),                                     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1549 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>keep_unused=keep_unused, inline=inline,                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">profiler.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">33</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #0000ff; text-decoration-color: #0000ff">5</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">wrapper</span>                                                                                     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">332 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">@wraps</span>(func)                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">333 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">wrapper</span>(*args, **kwargs):                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">334 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">with</span> TraceAnnotation(name, **decorator_kwargs):                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>335 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> func(*args, **kwargs)                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">336 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> wrapper                                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">337 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> wrapper                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">338 </span>                                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/interpreters/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">p</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">xla.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">2135</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">lower_sharding_computation</span>                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2132 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>prim_requires_devices = dispatch.jaxpr_has_prim_requiring_devices(jaxpr)                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2133 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2134 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>(module, keepalive, host_callbacks, unordered_effects, ordered_effects,                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>2135 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">   </span>nreps, tuple_args, shape_poly_state) = _cached_lowering_to_hlo(                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2136 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│      </span>closed_jaxpr, api_name, fun_name, backend, semantic_in_shardings,                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2137 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│      </span>semantic_out_shardings, in_layouts, out_layouts, <span style="color: #00ffff; text-decoration-color: #00ffff">len</span>(da_object),                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2138 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│      </span><span style="color: #00ffff; text-decoration-color: #00ffff">tuple</span>(da_object) <span style="color: #0000ff; text-decoration-color: #0000ff">if</span> prim_requires_devices <span style="color: #0000ff; text-decoration-color: #0000ff">else</span> <span style="color: #0000ff; text-decoration-color: #0000ff">None</span>, donated_invars,               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/interpreters/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">p</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">xla.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1941</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_cached_lowering_to_hlo</span>                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1938 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">with</span> dispatch.log_elapsed_time(                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1939 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span><span style="color: #808000; text-decoration-color: #808000">"Finished jaxpr to MLIR module conversion {fun_name} in {elapsed_time} sec"</span>,      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1940 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>fun_name=<span style="color: #00ffff; text-decoration-color: #00ffff">str</span>(name_stack), event=dispatch.JAXPR_TO_MLIR_MODULE_EVENT):             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1941 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>lowering_result = mlir.lower_jaxpr_to_module(                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1942 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>module_name,                                                                      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1943 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>closed_jaxpr,                                                                     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1944 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>ordered_effects=ordered_effects,                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/interpreters/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">m</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">lir.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1002</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">lower_jaxpr_to_module</span>                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 999 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>emit_diagnostic_info(n)                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1000 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">for</span> d <span style="color: #ff00ff; text-decoration-color: #ff00ff">in</span> e.error_diagnostics:                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1001 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>emit_diagnostic_info(d)                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1002 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">raise</span> <span style="color: #00ffff; text-decoration-color: #00ffff">ValueError</span>(<span style="color: #808000; text-decoration-color: #808000">"\n"</span>.join(msg_lines) +                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1003 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   │    </span>dump_module_message(ctx.module, <span style="color: #808000; text-decoration-color: #808000">"verification"</span>)) <span style="color: #0000ff; text-decoration-color: #0000ff">from</span> <span style="color: #00ffff; text-decoration-color: #00ffff; text-decoration: underline">e</span>              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1004 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1005 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> LoweringResult(ctx.module, ctx.keepalives, ctx.host_callbacks,                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">╰──────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
<span style="color: #ff0000; text-decoration-color: #ff0000; font-weight: bold">ValueError: </span>Cannot lower jaxpr with verifier errors:
        <span style="color: #008000; text-decoration-color: #008000">'stablehlo.add'</span> op requires compatible types for all operands and results
                at <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">loc</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"jit(add)/jit(main)/add"</span><span style="font-weight: bold">(</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"&lt;module&gt;"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/tmp/ipykernel_176355/3435837498.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">2:0</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_code"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPyt</span>
<span style="color: #008000; text-decoration-color: #008000">hon/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3577:20</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_ast_nodes"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages</span>
<span style="color: #008000; text-decoration-color: #008000">/IPython/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3517:19</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_cell_async"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-package</span>
<span style="color: #008000; text-decoration-color: #008000">s/IPython/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3334:29</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"_pseudo_sync_runner"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPython/co</span>
<span style="color: #008000; text-decoration-color: #008000">re/async_helpers.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">129:8</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell._run_cell"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPy</span>
<span style="color: #008000; text-decoration-color: #008000">thon/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3130:21</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_cell"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPyt</span>
<span style="color: #008000; text-decoration-color: #008000">hon/core/interactiveshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3075:21</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"ZMQInteractiveShell.run_cell"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/i</span>
<span style="color: #008000; text-decoration-color: #008000">pykernel/zmqshell.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">549:15</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"IPythonKernel.do_execute"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/ipyke</span>
<span style="color: #008000; text-decoration-color: #008000">rnel/ipkernel.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">449:26</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> at </span>
<span style="color: #008000; text-decoration-color: #008000">"Kernel.execute_request"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/ipykernel/kernel</span>
<span style="color: #008000; text-decoration-color: #008000">base.py"</span><span style="color: #000000; text-decoration-color: #000000">:</span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">778:28</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">))))))))))))</span>
<span style="color: #000000; text-decoration-color: #000000">        see current operation: %</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span><span style="color: #000000; text-decoration-color: #000000"> = </span><span style="color: #008000; text-decoration-color: #008000">"stablehlo.add"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #000000; text-decoration-color: #000000">%arg0, %arg1</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> : </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #000000; text-decoration-color: #000000">tensor&lt;i32&gt;, tensor&lt;f32&gt;</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="color: #000000; text-decoration-color: #000000"> -&gt; tensor&lt;i32&gt;</span>
<span style="color: #000000; text-decoration-color: #000000">                at </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">loc</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"jit(add)/jit(main)/add"</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"&lt;module&gt;"</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/tmp/ipykernel_176355/3435837498.py"</span>:<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">2:0</span><span style="font-weight: bold">)</span> at 
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_code"</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPyt</span>
<span style="color: #008000; text-decoration-color: #008000">hon/core/interactiveshell.py"</span>:<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3577:20</span><span style="font-weight: bold">)</span> at 
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_ast_nodes"</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages</span>
<span style="color: #008000; text-decoration-color: #008000">/IPython/core/interactiveshell.py"</span>:<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3517:19</span><span style="font-weight: bold">)</span> at 
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_cell_async"</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-package</span>
<span style="color: #008000; text-decoration-color: #008000">s/IPython/core/interactiveshell.py"</span>:<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3334:29</span><span style="font-weight: bold">)</span> at 
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"_pseudo_sync_runner"</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPython/co</span>
<span style="color: #008000; text-decoration-color: #008000">re/async_helpers.py"</span>:<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">129:8</span><span style="font-weight: bold">)</span> at 
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell._run_cell"</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPy</span>
<span style="color: #008000; text-decoration-color: #008000">thon/core/interactiveshell.py"</span>:<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3130:21</span><span style="font-weight: bold">)</span> at 
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"InteractiveShell.run_cell"</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/IPyt</span>
<span style="color: #008000; text-decoration-color: #008000">hon/core/interactiveshell.py"</span>:<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">3075:21</span><span style="font-weight: bold">)</span> at 
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"ZMQInteractiveShell.run_cell"</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/i</span>
<span style="color: #008000; text-decoration-color: #008000">pykernel/zmqshell.py"</span>:<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">549:15</span><span style="font-weight: bold">)</span> at 
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">callsite</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"IPythonKernel.do_execute"</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/ipyke</span>
<span style="color: #008000; text-decoration-color: #008000">rnel/ipkernel.py"</span>:<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">449:26</span><span style="font-weight: bold">)</span> at 
<span style="color: #008000; text-decoration-color: #008000">"Kernel.execute_request"</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">"/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/ipykernel/kernel</span>
<span style="color: #008000; text-decoration-color: #008000">base.py"</span>:<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">778:28</span><span style="font-weight: bold">))))))))))))</span>Define JAX_DUMP_IR_TO to dump the module.
</pre>
</div></div>
</div>
<p>If using <code class="docutils literal notranslate"><span class="pre">jax.lax</span></code> directly, you’ll have to do type promotion explicitly in such cases:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lax</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Magenta">Array</span><span class=" -Color -Color-Bold">(</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">2</span>., <span class=" -Color -Color-Yellow">dtype</span>=<span class=" -Color -Color-Magenta">float32</span><span class=" -Color -Color-Bold">)</span>
</pre></div>
</div>
</div>
</div>
<p>Along with this strictness, <code class="docutils literal notranslate"><span class="pre">jax.lax</span></code> also provides efficient APIs for some more general operations than are supported by NumPy.</p>
<p>For example, consider a 1D convolution, which can be expressed in NumPy this way:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">jnp</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Magenta">Array</span><span class=" -Color -Color-Bold">([</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">1</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">3</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">3</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">1</span>.<span class=" -Color -Color-Bold">]</span>, <span class=" -Color -Color-Yellow">dtype</span>=<span class=" -Color -Color-Magenta">float32</span><span class=" -Color -Color-Bold">)</span>
</pre></div>
</div>
</div>
</div>
<p>Under the hood, this NumPy operation is translated to a much more general convolution implemented by <a class="reference external" href="https://jax.readthedocs.io/en/latest/_autosummary/jax.lax.conv_general_dilated.html"><code class="docutils literal notranslate"><span class="pre">lax.conv_general_dilated</span></code></a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">lax</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">conv_general_dilated</span><span class="p">(</span>
    <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span>  <span class="c1"># note: explicit promotion</span>
    <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="n">window_strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
    <span class="n">padding</span><span class="o">=</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>  <span class="c1"># equivalent of padding=&#39;full&#39; in NumPy</span>
<span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Magenta">Array</span><span class=" -Color -Color-Bold">([</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">1</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">3</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">3</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">1</span>.<span class=" -Color -Color-Bold">]</span>, <span class=" -Color -Color-Yellow">dtype</span>=<span class=" -Color -Color-Magenta">float32</span><span class=" -Color -Color-Bold">)</span>
</pre></div>
</div>
</div>
</div>
<p>This is a batched convolution operation designed to be efficient for the types of convolutions often used in deep neural nets. It requires much more boilerplate, but is far more flexible and scalable than the convolution provided by NumPy (See <a class="reference external" href="https://jax.readthedocs.io/en/latest/notebooks/convolutions.html">Convolutions in JAX</a> for more detail on JAX convolutions).</p>
<p>At their heart, all <code class="docutils literal notranslate"><span class="pre">jax.lax</span></code> operations are Python wrappers for operations in XLA; here, for example, the convolution implementation is provided by <a class="reference external" href="https://www.tensorflow.org/xla/operation_semantics#convwithgeneralpadding_convolution">XLA:ConvWithGeneralPadding</a>.
Every JAX operation is eventually expressed in terms of these fundamental XLA operations, which is what enables just-in-time (JIT) compilation.</p>
</section>
<section id="to-jit-or-not-to-jit">
<h2>To JIT or not to JIT<a class="headerlink" href="#to-jit-or-not-to-jit" title="Link to this heading">#</a></h2>
<p><strong>Key Concepts:</strong></p>
<ul class="simple">
<li><p>By default JAX executes operations one at a time, in sequence.</p></li>
<li><p>Using a just-in-time (JIT) compilation decorator, sequences of operations can be optimized together and run at once.</p></li>
<li><p>Not all JAX code can be JIT compiled, as it requires array shapes to be static &amp; known at compile time.</p></li>
</ul>
<p>The fact that all JAX operations are expressed in terms of XLA allows JAX to use the XLA compiler to execute blocks of code very efficiently.</p>
<p>For example, consider this function that normalizes the rows of a 2D matrix, expressed in terms of <code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code> operations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>

<span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">-</span> <span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">X</span> <span class="o">/</span> <span class="n">X</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>A just-in-time compiled version of the function can be created using the <code class="docutils literal notranslate"><span class="pre">jax.jit</span></code> transform:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">jit</span>
<span class="n">norm_compiled</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="n">norm</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This function returns the same results as the original, up to standard floating-point accuracy:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1701</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">norm_compiled</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1E-6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>But due to the compilation (which includes fusing of operations, avoidance of allocating temporary arrays, and a host of other tricks), execution times can be orders of magnitude faster in the JIT-compiled case (note the use of <code class="docutils literal notranslate"><span class="pre">block_until_ready()</span></code> to account for JAX’s <a class="reference external" href="https://jax.readthedocs.io/en/latest/async_dispatch.html">asynchronous dispatch</a>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> norm(X).block_until_ready()
<span class="o">%</span><span class="k">timeit</span> norm_compiled(X).block_until_ready()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>134 µs ± 2.7 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
121 µs ± 1.61 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
</pre></div>
</div>
</div>
</div>
<p>That said, <code class="docutils literal notranslate"><span class="pre">jax.jit</span></code> does have limitations: in particular, it requires all arrays to have static shapes. That means that some JAX operations are incompatible with JIT compilation.</p>
<p>For example, this operation can be executed in op-by-op mode:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_negatives</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">get_negatives</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Magenta">Array</span><span class=" -Color -Color-Bold">([</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">-0.10570311</span>, <span class=" -Color -Color-Bold -Color-Bold-Cyan">-0.59403396</span>, <span class=" -Color -Color-Bold -Color-Bold-Cyan">-0.8680282</span> , <span class=" -Color -Color-Bold -Color-Bold-Cyan">-0.23489487</span><span class=" -Color -Color-Bold">]</span>, <span class=" -Color -Color-Yellow">dtype</span>=<span class=" -Color -Color-Magenta">float32</span><span class=" -Color -Color-Bold">)</span>
</pre></div>
</div>
</div>
</div>
<p>But it returns an error if you attempt to execute it in jit mode:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jit</span><span class="p">(</span><span class="n">get_negatives</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800000; text-decoration-color: #800000">╭─────────────────────────────── </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">Traceback </span><span style="color: #bf7f7f; text-decoration-color: #bf7f7f; font-weight: bold">(most recent call last)</span><span style="color: #800000; text-decoration-color: #800000"> ────────────────────────────────╮</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">&lt;module&gt;</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1</span>                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1 jit(get_negatives)(x)                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2 </span>                                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">traceback_util</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">179</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">reraise_with_filtered_traceback</span>                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">176 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">reraise_with_filtered_traceback</span>(*args, **kwargs):                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">177 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>__tracebackhide__ = <span style="color: #0000ff; text-decoration-color: #0000ff">True</span>                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">178 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">try</span>:                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>179 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> fun(*args, **kwargs)                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">180 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">except</span> <span style="color: #00ffff; text-decoration-color: #00ffff">Exception</span> <span style="color: #0000ff; text-decoration-color: #0000ff">as</span> e:                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">181 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>mode = _filtering_mode()                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">182 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> _is_under_reraiser(e) <span style="color: #ff00ff; text-decoration-color: #ff00ff">or</span> mode == <span style="color: #808000; text-decoration-color: #808000">"off"</span>:                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">298</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">cache_miss</span>                                                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 295 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 296 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">@api_boundary</span>                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 297 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">cache_miss</span>(*args, **kwargs):                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 298 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>outs, out_flat, out_tree, args_flat, jaxpr, attrs_tracked = _python_pjit_helper(      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 299 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>jit_info, *args, **kwargs)                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 300 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>executable = _read_most_recent_pjit_call_executable(jaxpr)                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 301 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>maybe_fastpath_data = _get_fastpath_data(                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">167</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_python_pjit_helper</span>                                                                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 164 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 165 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_python_pjit_helper</span>(jit_info, *args, **kwargs):                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 166 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>args_flat, _, params, _, out_tree, _, _, _, arg_names, attrs_tracked = \                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 167 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>_infer_params(jit_info, args, kwargs)                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 168 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">for</span> arg <span style="color: #ff00ff; text-decoration-color: #ff00ff">in</span> args_flat:                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 169 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>dispatch.check_arg(arg)                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 170 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">581</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_infer_params</span>                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 578 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>in_shardings_treedef, in_shardings_leaves, hashable_pytree(in_layouts),             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 579 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>in_avals, in_tree, dbg, device_or_backend_set, have_kwargs)                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 580 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 581 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>jaxpr, consts, out_shardings, out_layouts_flat, attrs_tracked = _pjit_jaxpr(            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 582 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>flat_fun, out_shardings_treedef, out_shardings_leaves,                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 583 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>hashable_pytree(out_layouts), in_type, dbg, device_or_backend_set,                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 584 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>HashableFunction(out_tree, closure=()),                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1202</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_pjit_jaxpr</span>                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1199 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_pjit_jaxpr</span>(fun, out_shardings_treedef, out_shardings_leaves,                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1200 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   </span>out_layouts_thunk, in_type, debug_info, device_or_backend_set,            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1201 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   </span>out_tree, result_paths, inline):                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1202 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>jaxpr, final_consts, out_type, attrs_tracked = _create_pjit_jaxpr(                      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1203 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>fun, in_type, debug_info, result_paths, IgnoreKey(inline))                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1204 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>canonicalized_out_shardings_flat, out_layouts_flat = _check_and_canonicalize_out_shard  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1205 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>out_shardings_treedef, out_shardings_leaves, out_layouts_thunk, out_tree, <span style="color: #00ffff; text-decoration-color: #00ffff">tuple</span>(ou  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">linear_util.py</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> :<span style="color: #0000ff; text-decoration-color: #0000ff">350</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">memoized_fun</span>                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">347 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>ans, stores = result                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">348 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>fun.populate_stores(stores)                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">349 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">else</span>:                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>350 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>ans = call(fun, *args)                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">351 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> explain <span style="color: #ff00ff; text-decoration-color: #ff00ff">and</span> config.explain_cache_misses.value:                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">352 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>explain(fun.f, cache <span style="color: #ff00ff; text-decoration-color: #ff00ff">is</span> new_cache, cache, key, ans)                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">353 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>cache[key] = (ans, fun.stores)                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1146</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_create_pjit_jaxpr</span>                                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1143 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │     </span>lu.annotate(fun, in_type), debug_info=pe_debug)                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1144 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>attrs_tracked = []                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1145 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">else</span>:                                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1146 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>jaxpr, global_out_avals, consts, attrs_tracked = pe.trace_to_jaxpr_dynamic(         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1147 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │     </span>fun, in_type, debug_info=pe_debug)                                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1148 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1149 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># TODO(dougalm,mattjj): enable debug info with attrs_tracked</span>                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">profiler.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">33</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #0000ff; text-decoration-color: #0000ff">5</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">wrapper</span>                                                                                     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">332 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">@wraps</span>(func)                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">333 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">wrapper</span>(*args, **kwargs):                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">334 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">with</span> TraceAnnotation(name, **decorator_kwargs):                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>335 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> func(*args, **kwargs)                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">336 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> wrapper                                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">337 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> wrapper                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">338 </span>                                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/interpreters/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">p</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">artial_eval.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">2322</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">trace_to_jaxpr_dynamic</span>                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2319 </span>) -&gt; <span style="color: #00ffff; text-decoration-color: #00ffff">tuple</span>[Jaxpr, <span style="color: #00ffff; text-decoration-color: #00ffff">list</span>[AbstractValue], <span style="color: #00ffff; text-decoration-color: #00ffff">list</span>[Any], <span style="color: #00ffff; text-decoration-color: #00ffff">list</span>[<span style="color: #00ffff; text-decoration-color: #00ffff">tuple</span>[Any, <span style="color: #00ffff; text-decoration-color: #00ffff">str</span>]]]:                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2320 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">with</span> core.new_main(DynamicJaxprTrace, dynamic=<span style="color: #0000ff; text-decoration-color: #0000ff">True</span>) <span style="color: #0000ff; text-decoration-color: #0000ff">as</span> main:  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># type: ignore</span>            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2321 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>main.jaxpr_stack = ()  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># type: ignore</span>                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>2322 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>jaxpr, out_avals, consts, attrs_tracked = trace_to_subjaxpr_dynamic(                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2323 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>fun, main, in_avals, keep_inputs=keep_inputs, debug_info=debug_info)                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2324 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">del</span> main, fun                                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2325 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> jaxpr, out_avals, consts, attrs_tracked                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/interpreters/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">p</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">artial_eval.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">2344</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">trace_to_subjaxpr_dynamic</span>                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2341 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>trace = DynamicJaxprTrace(main, core.cur_sublevel())                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2342 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>in_tracers = _input_type_to_tracers(trace.new_arg, in_avals)                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2343 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>in_tracers_ = [t <span style="color: #0000ff; text-decoration-color: #0000ff">for</span> t, keep <span style="color: #ff00ff; text-decoration-color: #ff00ff">in</span> <span style="color: #00ffff; text-decoration-color: #00ffff">zip</span>(in_tracers, keep_inputs) <span style="color: #0000ff; text-decoration-color: #0000ff">if</span> keep]                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>2344 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>ans = fun.call_wrapped(*in_tracers_)                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2345 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>out_tracers = <span style="color: #00ffff; text-decoration-color: #00ffff">map</span>(trace.full_raise, ans)                                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2346 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>jaxpr, consts, attrs_tracked = frame.to_jaxpr(out_tracers)                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2347 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">del</span> fun, main, trace, frame, in_tracers, out_tracers, ans                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">linear_util.py</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> :<span style="color: #0000ff; text-decoration-color: #0000ff">192</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">call_wrapped</span>                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">189 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>gen = gen_static_args = out_store = <span style="color: #0000ff; text-decoration-color: #0000ff">None</span>                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">190 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>                                                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">191 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">try</span>:                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>192 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>ans = <span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.f(*args, **<span style="color: #00ffff; text-decoration-color: #00ffff">dict</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.params, **kwargs))                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">193 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">except</span>:                                                                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">194 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># Some transformations yield from inside context managers, so we have to</span>             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">195 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># interrupt them before reraising the exception. Otherwise they will only</span>            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">get_negatives</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">2</span>                                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">get_negatives</span>(x):                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>2 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> x[x &lt; <span style="color: #0000ff; text-decoration-color: #0000ff">0</span>]                                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">3 </span>                                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4 </span>x = jnp.array(np.random.randn(<span style="color: #0000ff; text-decoration-color: #0000ff">10</span>))                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">5 </span>get_negatives(x)                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/numpy/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">array_me</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">thods.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">736</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">op</span>                                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">733 </span>                                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">734 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_forward_operator_to_aval</span>(name):                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">735 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">op</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, *args):                                                                     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>736 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> <span style="color: #00ffff; text-decoration-color: #00ffff">getattr</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.aval, <span style="color: #808000; text-decoration-color: #808000">f"_{</span>name<span style="color: #808000; text-decoration-color: #808000">}"</span>)(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, *args)                                     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">737 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> op                                                                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">738 </span>                                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">739 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_forward_method_to_aval</span>(name):                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/numpy/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">array_me</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">thods.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">349</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_getitem</span>                                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">346 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">yield</span> lax.dynamic_slice_in_dim(x, num_chunks * size, tail)                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">347 </span>                                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">348 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_getitem</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, item):                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>349 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> lax_numpy._rewriting_take(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, item)                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">350 </span>                                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">351 # Syntactic sugar for scatter operations.</span>                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">352 </span><span style="color: #0000ff; text-decoration-color: #0000ff">class</span> <span style="color: #00ff00; text-decoration-color: #00ff00; text-decoration: underline">_IndexUpdateHelper</span>:                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/numpy/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">lax_nump</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">y.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">4603</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_rewriting_take</span>                                                                     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4600 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │     </span><span style="color: #00ffff; text-decoration-color: #00ffff">isinstance</span>(arr.shape[<span style="color: #0000ff; text-decoration-color: #0000ff">0</span>], <span style="color: #00ffff; text-decoration-color: #00ffff">int</span>)):                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4601 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> lax.dynamic_index_in_dim(arr, idx, keepdims=<span style="color: #0000ff; text-decoration-color: #0000ff">False</span>)                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4602 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>4603 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>treedef, static_idx, dynamic_idx = _split_index_for_jit(idx, arr.shape)                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4604 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> _gather(arr, treedef, static_idx, dynamic_idx, indices_are_sorted,               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4605 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │    </span>unique_indices, mode, fill_value)                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4606 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/numpy/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">lax_nump</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">y.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">4688</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_split_index_for_jit</span>                                                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4685 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4686 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># Expand any (concrete) boolean indices. We can then use advanced integer</span>               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4687 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># indexing logic to handle them.</span>                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>4688 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>idx = _expand_bool_indices(idx, shape)                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4689 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4690 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>leaves, treedef = tree_flatten(idx)                                                     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4691 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>dynamic = [<span style="color: #0000ff; text-decoration-color: #0000ff">None</span>] * <span style="color: #00ffff; text-decoration-color: #00ffff">len</span>(leaves)                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/numpy/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">lax_nump</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">y.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">4986</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_expand_bool_indices</span>                                                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4983 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4984 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> <span style="color: #ff00ff; text-decoration-color: #ff00ff">not</span> <span style="color: #00ffff; text-decoration-color: #00ffff">type</span>(abstract_i) <span style="color: #ff00ff; text-decoration-color: #ff00ff">is</span> ConcreteArray:                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4985 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># TODO(mattjj): improve this error by tracking _why_ the indices are not concret</span>  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>4986 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span><span style="color: #0000ff; text-decoration-color: #0000ff">raise</span> errors.NonConcreteBooleanIndexError(abstract_i)                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4987 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">elif</span> _ndim(i) == <span style="color: #0000ff; text-decoration-color: #0000ff">0</span>:                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4988 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>out.append(<span style="color: #00ffff; text-decoration-color: #00ffff">bool</span>(i))                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4989 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">else</span>:                                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">╰──────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
<span style="color: #ff0000; text-decoration-color: #ff0000; font-weight: bold">NonConcreteBooleanIndexError: </span>Array boolean indices must be concrete; got <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">ShapedArray</span><span style="font-weight: bold">(</span>bool<span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span><span style="font-weight: bold">])</span>

See <span style="color: #0000ff; text-decoration-color: #0000ff; text-decoration: underline">https://jax.readthedocs.io/en/latest/errors.html#jax.errors.NonConcreteBooleanIndexError</span>
</pre>
</div></div>
</div>
<p>This is because the function generates an array whose shape is not known at compile time: the size of the output depends on the values of the input array, and so it is not compatible with JIT.</p>
</section>
<section id="jit-mechanics-tracing-and-static-variables">
<h2>JIT mechanics: tracing and static variables<a class="headerlink" href="#jit-mechanics-tracing-and-static-variables" title="Link to this heading">#</a></h2>
<p><strong>Key Concepts:</strong></p>
<ul class="simple">
<li><p>JIT and other JAX transforms work by <em>tracing</em> a function to determine its effect on inputs of a specific shape and type.</p></li>
<li><p>Variables that you don’t want to be traced can be marked as <em>static</em></p></li>
</ul>
<p>To use <code class="docutils literal notranslate"><span class="pre">jax.jit</span></code> effectively, it is useful to understand how it works. Let’s put a few <code class="docutils literal notranslate"><span class="pre">print()</span></code> statements within a JIT-compiled function and then call the function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running f():&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  x = </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  y = </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  result = </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">result</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running f():
  x = Traced&lt;ShapedArray(float32[3,4])&gt;with&lt;DynamicJaxprTrace(level=1/0)&gt;
  y = Traced&lt;ShapedArray(float32[4])&gt;with&lt;DynamicJaxprTrace(level=1/0)&gt;
  result = Traced&lt;ShapedArray(float32[3])&gt;with&lt;DynamicJaxprTrace(level=1/0)&gt;
</pre></div>
</div>
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Magenta">Array</span><span class=" -Color -Color-Bold">([</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">0.25773212</span>, <span class=" -Color -Color-Bold -Color-Bold-Cyan">5.3623195</span> , <span class=" -Color -Color-Bold -Color-Bold-Cyan">5.403243</span>  <span class=" -Color -Color-Bold">]</span>, <span class=" -Color -Color-Yellow">dtype</span>=<span class=" -Color -Color-Magenta">float32</span><span class=" -Color -Color-Bold">)</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that the print statements execute, but rather than printing the data we passed to the function, though, it prints <em>tracer</em> objects that stand-in for them.</p>
<p>These tracer objects are what <code class="docutils literal notranslate"><span class="pre">jax.jit</span></code> uses to extract the sequence of operations specified by the function. Basic tracers are stand-ins that encode the <strong>shape</strong> and <strong>dtype</strong> of the arrays, but are agnostic to the values. This recorded sequence of computations can then be efficiently applied within XLA to new inputs with the same shape and dtype, without having to re-execute the Python code.</p>
<p>When we call the compiled function again on matching inputs, no re-compilation is required and nothing is printed because the result is computed in compiled XLA rather than in Python:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">f</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Magenta">Array</span><span class=" -Color -Color-Bold">([</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">1.4344584</span>, <span class=" -Color -Color-Bold -Color-Bold-Cyan">4.3004413</span>, <span class=" -Color -Color-Bold -Color-Bold-Cyan">7.9897013</span><span class=" -Color -Color-Bold">]</span>, <span class=" -Color -Color-Yellow">dtype</span>=<span class=" -Color -Color-Magenta">float32</span><span class=" -Color -Color-Bold">)</span>
</pre></div>
</div>
</div>
</div>
<p>The extracted sequence of operations is encoded in a JAX expression, or <em>jaxpr</em> for short. You can view the jaxpr using the <code class="docutils literal notranslate"><span class="pre">jax.make_jaxpr</span></code> transformation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">make_jaxpr</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">make_jaxpr</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">{</span> lambda ; <span class=" -Color -Color-Bold">a:f32[</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">3</span>,<span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span><span class=" -Color -Color-Bold">]</span> <span class=" -Color -Color-Bold">b:f32[</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span><span class=" -Color -Color-Bold">]</span>. let
    <span class=" -Color -Color-Bold">c:f32[</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">3</span>,<span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span><span class=" -Color -Color-Bold">]</span> = add a <span class=" -Color -Color-Bold -Color-Bold-Cyan">1.0</span>
    <span class=" -Color -Color-Bold">d:f32[</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">4</span><span class=" -Color -Color-Bold">]</span> = add b <span class=" -Color -Color-Bold -Color-Bold-Cyan">1.0</span>
    <span class=" -Color -Color-Bold">e:f32[</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">3</span><span class=" -Color -Color-Bold">]</span> = dot_general<span class=" -Color -Color-Bold">[</span>
      <span class=" -Color -Color-Yellow">dimension_numbers</span>=<span class=" -Color -Color-Bold">(([</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">1</span><span class=" -Color -Color-Bold">]</span>, <span class=" -Color -Color-Bold">[</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">0</span><span class=" -Color -Color-Bold">])</span>, <span class=" -Color -Color-Bold">([]</span>, <span class=" -Color -Color-Bold">[]))</span>
      <span class=" -Color -Color-Yellow">preferred_element_type</span>=<span class=" -Color -Color-Magenta">float32</span>
    <span class=" -Color -Color-Bold">]</span> c d
  in <span class=" -Color -Color-Bold">(</span>e,<span class=" -Color -Color-Bold">)</span> <span class=" -Color -Color-Bold">}</span>
</pre></div>
</div>
</div>
</div>
<p>Note one consequence of this: because JIT compilation is done <em>without</em> information on the content of the array, control flow statements in the function cannot depend on traced values. For example, this fails:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">neg</span><span class="p">):</span>
  <span class="k">return</span> <span class="o">-</span><span class="n">x</span> <span class="k">if</span> <span class="n">neg</span> <span class="k">else</span> <span class="n">x</span>

<span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800000; text-decoration-color: #800000">╭─────────────────────────────── </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">Traceback </span><span style="color: #bf7f7f; text-decoration-color: #bf7f7f; font-weight: bold">(most recent call last)</span><span style="color: #800000; text-decoration-color: #800000"> ────────────────────────────────╮</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">&lt;module&gt;</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">5</span>                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">f</span>(x, neg):                                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">3 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> -x <span style="color: #0000ff; text-decoration-color: #0000ff">if</span> neg <span style="color: #0000ff; text-decoration-color: #0000ff">else</span> x                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4 </span>                                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>5 f(<span style="color: #0000ff; text-decoration-color: #0000ff">1</span>, <span style="color: #0000ff; text-decoration-color: #0000ff">True</span>)                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">6 </span>                                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">traceback_util</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">179</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">reraise_with_filtered_traceback</span>                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">176 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">reraise_with_filtered_traceback</span>(*args, **kwargs):                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">177 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>__tracebackhide__ = <span style="color: #0000ff; text-decoration-color: #0000ff">True</span>                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">178 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">try</span>:                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>179 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> fun(*args, **kwargs)                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">180 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">except</span> <span style="color: #00ffff; text-decoration-color: #00ffff">Exception</span> <span style="color: #0000ff; text-decoration-color: #0000ff">as</span> e:                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">181 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>mode = _filtering_mode()                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">182 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> _is_under_reraiser(e) <span style="color: #ff00ff; text-decoration-color: #ff00ff">or</span> mode == <span style="color: #808000; text-decoration-color: #808000">"off"</span>:                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">298</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">cache_miss</span>                                                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 295 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 296 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">@api_boundary</span>                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 297 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">cache_miss</span>(*args, **kwargs):                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 298 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>outs, out_flat, out_tree, args_flat, jaxpr, attrs_tracked = _python_pjit_helper(      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 299 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>jit_info, *args, **kwargs)                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 300 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>executable = _read_most_recent_pjit_call_executable(jaxpr)                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 301 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>maybe_fastpath_data = _get_fastpath_data(                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">167</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_python_pjit_helper</span>                                                                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 164 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 165 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_python_pjit_helper</span>(jit_info, *args, **kwargs):                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 166 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>args_flat, _, params, _, out_tree, _, _, _, arg_names, attrs_tracked = \                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 167 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>_infer_params(jit_info, args, kwargs)                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 168 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">for</span> arg <span style="color: #ff00ff; text-decoration-color: #ff00ff">in</span> args_flat:                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 169 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>dispatch.check_arg(arg)                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 170 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">581</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_infer_params</span>                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 578 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>in_shardings_treedef, in_shardings_leaves, hashable_pytree(in_layouts),             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 579 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>in_avals, in_tree, dbg, device_or_backend_set, have_kwargs)                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 580 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 581 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>jaxpr, consts, out_shardings, out_layouts_flat, attrs_tracked = _pjit_jaxpr(            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 582 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>flat_fun, out_shardings_treedef, out_shardings_leaves,                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 583 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>hashable_pytree(out_layouts), in_type, dbg, device_or_backend_set,                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 584 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>HashableFunction(out_tree, closure=()),                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1202</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_pjit_jaxpr</span>                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1199 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_pjit_jaxpr</span>(fun, out_shardings_treedef, out_shardings_leaves,                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1200 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   </span>out_layouts_thunk, in_type, debug_info, device_or_backend_set,            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1201 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   </span>out_tree, result_paths, inline):                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1202 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>jaxpr, final_consts, out_type, attrs_tracked = _create_pjit_jaxpr(                      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1203 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>fun, in_type, debug_info, result_paths, IgnoreKey(inline))                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1204 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>canonicalized_out_shardings_flat, out_layouts_flat = _check_and_canonicalize_out_shard  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1205 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>out_shardings_treedef, out_shardings_leaves, out_layouts_thunk, out_tree, <span style="color: #00ffff; text-decoration-color: #00ffff">tuple</span>(ou  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">linear_util.py</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> :<span style="color: #0000ff; text-decoration-color: #0000ff">350</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">memoized_fun</span>                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">347 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>ans, stores = result                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">348 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>fun.populate_stores(stores)                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">349 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">else</span>:                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>350 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>ans = call(fun, *args)                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">351 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> explain <span style="color: #ff00ff; text-decoration-color: #ff00ff">and</span> config.explain_cache_misses.value:                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">352 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>explain(fun.f, cache <span style="color: #ff00ff; text-decoration-color: #ff00ff">is</span> new_cache, cache, key, ans)                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">353 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>cache[key] = (ans, fun.stores)                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1146</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_create_pjit_jaxpr</span>                                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1143 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │     </span>lu.annotate(fun, in_type), debug_info=pe_debug)                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1144 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>attrs_tracked = []                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1145 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">else</span>:                                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1146 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>jaxpr, global_out_avals, consts, attrs_tracked = pe.trace_to_jaxpr_dynamic(         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1147 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │     </span>fun, in_type, debug_info=pe_debug)                                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1148 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1149 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># TODO(dougalm,mattjj): enable debug info with attrs_tracked</span>                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">profiler.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">33</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #0000ff; text-decoration-color: #0000ff">5</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">wrapper</span>                                                                                     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">332 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">@wraps</span>(func)                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">333 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">wrapper</span>(*args, **kwargs):                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">334 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">with</span> TraceAnnotation(name, **decorator_kwargs):                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>335 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> func(*args, **kwargs)                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">336 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> wrapper                                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">337 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> wrapper                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">338 </span>                                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/interpreters/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">p</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">artial_eval.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">2322</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">trace_to_jaxpr_dynamic</span>                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2319 </span>) -&gt; <span style="color: #00ffff; text-decoration-color: #00ffff">tuple</span>[Jaxpr, <span style="color: #00ffff; text-decoration-color: #00ffff">list</span>[AbstractValue], <span style="color: #00ffff; text-decoration-color: #00ffff">list</span>[Any], <span style="color: #00ffff; text-decoration-color: #00ffff">list</span>[<span style="color: #00ffff; text-decoration-color: #00ffff">tuple</span>[Any, <span style="color: #00ffff; text-decoration-color: #00ffff">str</span>]]]:                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2320 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">with</span> core.new_main(DynamicJaxprTrace, dynamic=<span style="color: #0000ff; text-decoration-color: #0000ff">True</span>) <span style="color: #0000ff; text-decoration-color: #0000ff">as</span> main:  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># type: ignore</span>            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2321 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>main.jaxpr_stack = ()  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># type: ignore</span>                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>2322 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>jaxpr, out_avals, consts, attrs_tracked = trace_to_subjaxpr_dynamic(                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2323 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>fun, main, in_avals, keep_inputs=keep_inputs, debug_info=debug_info)                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2324 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">del</span> main, fun                                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2325 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> jaxpr, out_avals, consts, attrs_tracked                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/interpreters/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">p</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">artial_eval.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">2344</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">trace_to_subjaxpr_dynamic</span>                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2341 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>trace = DynamicJaxprTrace(main, core.cur_sublevel())                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2342 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>in_tracers = _input_type_to_tracers(trace.new_arg, in_avals)                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2343 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>in_tracers_ = [t <span style="color: #0000ff; text-decoration-color: #0000ff">for</span> t, keep <span style="color: #ff00ff; text-decoration-color: #ff00ff">in</span> <span style="color: #00ffff; text-decoration-color: #00ffff">zip</span>(in_tracers, keep_inputs) <span style="color: #0000ff; text-decoration-color: #0000ff">if</span> keep]                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>2344 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>ans = fun.call_wrapped(*in_tracers_)                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2345 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>out_tracers = <span style="color: #00ffff; text-decoration-color: #00ffff">map</span>(trace.full_raise, ans)                                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2346 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>jaxpr, consts, attrs_tracked = frame.to_jaxpr(out_tracers)                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2347 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">del</span> fun, main, trace, frame, in_tracers, out_tracers, ans                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">linear_util.py</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> :<span style="color: #0000ff; text-decoration-color: #0000ff">192</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">call_wrapped</span>                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">189 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>gen = gen_static_args = out_store = <span style="color: #0000ff; text-decoration-color: #0000ff">None</span>                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">190 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>                                                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">191 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">try</span>:                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>192 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>ans = <span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.f(*args, **<span style="color: #00ffff; text-decoration-color: #00ffff">dict</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.params, **kwargs))                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">193 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">except</span>:                                                                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">194 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># Some transformations yield from inside context managers, so we have to</span>             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">195 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># interrupt them before reraising the exception. Otherwise they will only</span>            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">f</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">3</span>                                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1 </span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">@jit</span>                                                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">f</span>(x, neg):                                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>3 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> -x <span style="color: #0000ff; text-decoration-color: #0000ff">if</span> neg <span style="color: #0000ff; text-decoration-color: #0000ff">else</span> x                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4 </span>                                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">5 </span>f(<span style="color: #0000ff; text-decoration-color: #0000ff">1</span>, <span style="color: #0000ff; text-decoration-color: #0000ff">True</span>)                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">6 </span>                                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">core.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">746</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">__bool__</span>                                                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 743 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 744 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">__bool__</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>):                                                                     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 745 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>check_bool_conversion(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>)                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 746 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> <span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.aval._bool(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>)                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 747 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 748 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">__int__</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>):                                                                      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 749 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>check_scalar_conversion(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>)                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">core.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1492</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">error</span>                                                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1489 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   │     </span><span style="color: #808000; text-decoration-color: #808000">f"or `jnp.array(x, {</span>fun.<span style="color: #ff0000; text-decoration-color: #ff0000">__name__</span><span style="color: #808000; text-decoration-color: #808000">})` instead."</span>)                      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1490 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> fun <span style="color: #ff00ff; text-decoration-color: #ff00ff">is</span> <span style="color: #00ffff; text-decoration-color: #00ffff">bool</span>:                                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1491 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">error</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, arg):                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1492 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">raise</span> TracerBoolConversionError(arg)                                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1493 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">elif</span> fun <span style="color: #ff00ff; text-decoration-color: #ff00ff">in</span> (<span style="color: #00ffff; text-decoration-color: #00ffff">hex</span>, <span style="color: #00ffff; text-decoration-color: #00ffff">oct</span>, operator.index):                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1494 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">error</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, arg):                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1495 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">raise</span> TracerIntegerConversionError(arg)                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">╰──────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
<span style="color: #ff0000; text-decoration-color: #ff0000; font-weight: bold">TracerBoolConversionError: </span>Attempted boolean conversion of traced array with shape bool<span style="font-weight: bold">[]</span>..
The error occurred while tracing the function f at <span style="color: #800080; text-decoration-color: #800080">/tmp/ipykernel_176355/</span><span style="color: #ff00ff; text-decoration-color: #ff00ff">2422663986.py</span>:<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> for jit. This concrete 
value was not available in Python because it depends on the value of the argument neg.
See <span style="color: #0000ff; text-decoration-color: #0000ff; text-decoration: underline">https://jax.readthedocs.io/en/latest/errors.html#jax.errors.TracerBoolConversionError</span>
</pre>
</div></div>
</div>
<p>If there are variables that you would not like to be traced, they can be marked as static for the purposes of JIT compilation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">neg</span><span class="p">):</span>
  <span class="k">return</span> <span class="o">-</span><span class="n">x</span> <span class="k">if</span> <span class="n">neg</span> <span class="k">else</span> <span class="n">x</span>

<span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Magenta">Array</span><span class=" -Color -Color-Bold">(</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">-1</span>, <span class=" -Color -Color-Yellow">dtype</span>=<span class=" -Color -Color-Magenta">int32</span>, <span class=" -Color -Color-Yellow">weak_type</span>=True<span class=" -Color -Color-Bold">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note that calling a JIT-compiled function with a different static argument results in re-compilation, so the function still works as expected:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Magenta">Array</span><span class=" -Color -Color-Bold">(</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">1</span>, <span class=" -Color -Color-Yellow">dtype</span>=<span class=" -Color -Color-Magenta">int32</span>, <span class=" -Color -Color-Yellow">weak_type</span>=True<span class=" -Color -Color-Bold">)</span>
</pre></div>
</div>
</div>
</div>
<p>Understanding which values and operations will be static and which will be traced is a key part of using <code class="docutils literal notranslate"><span class="pre">jax.jit</span></code> effectively.</p>
</section>
<section id="static-vs-traced-operations">
<h2>Static vs Traced Operations<a class="headerlink" href="#static-vs-traced-operations" title="Link to this heading">#</a></h2>
<p><strong>Key Concepts:</strong></p>
<ul class="simple">
<li><p>Just as values can be either static or traced, operations can be static or traced.</p></li>
<li><p>Static operations are evaluated at compile-time in Python; traced operations are compiled &amp; evaluated at run-time in XLA.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">numpy</span></code> for operations that you want to be static; use <code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code> for operations that you want to be traced.</p></li>
</ul>
<p>This distinction between static and traced values makes it important to think about how to keep a static value static. Consider this function:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">jit</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">())</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800000; text-decoration-color: #800000">╭─────────────────────────────── </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">Traceback </span><span style="color: #bf7f7f; text-decoration-color: #bf7f7f; font-weight: bold">(most recent call last)</span><span style="color: #800000; text-decoration-color: #800000"> ────────────────────────────────╮</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">&lt;module&gt;</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">9</span>                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 6 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> x.reshape(jnp.array(x.shape).prod())                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 7 </span>                                                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 8 </span>x = jnp.ones((<span style="color: #0000ff; text-decoration-color: #0000ff">2</span>, <span style="color: #0000ff; text-decoration-color: #0000ff">3</span>))                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 9 f(x)                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">10 </span>                                                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">traceback_util</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">179</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">reraise_with_filtered_traceback</span>                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">176 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">reraise_with_filtered_traceback</span>(*args, **kwargs):                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">177 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>__tracebackhide__ = <span style="color: #0000ff; text-decoration-color: #0000ff">True</span>                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">178 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">try</span>:                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>179 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> fun(*args, **kwargs)                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">180 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">except</span> <span style="color: #00ffff; text-decoration-color: #00ffff">Exception</span> <span style="color: #0000ff; text-decoration-color: #0000ff">as</span> e:                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">181 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>mode = _filtering_mode()                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">182 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> _is_under_reraiser(e) <span style="color: #ff00ff; text-decoration-color: #ff00ff">or</span> mode == <span style="color: #808000; text-decoration-color: #808000">"off"</span>:                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">298</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">cache_miss</span>                                                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 295 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 296 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">@api_boundary</span>                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 297 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">cache_miss</span>(*args, **kwargs):                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 298 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>outs, out_flat, out_tree, args_flat, jaxpr, attrs_tracked = _python_pjit_helper(      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 299 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>jit_info, *args, **kwargs)                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 300 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>executable = _read_most_recent_pjit_call_executable(jaxpr)                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 301 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>maybe_fastpath_data = _get_fastpath_data(                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">167</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_python_pjit_helper</span>                                                                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 164 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 165 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_python_pjit_helper</span>(jit_info, *args, **kwargs):                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 166 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>args_flat, _, params, _, out_tree, _, _, _, arg_names, attrs_tracked = \                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 167 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>_infer_params(jit_info, args, kwargs)                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 168 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">for</span> arg <span style="color: #ff00ff; text-decoration-color: #ff00ff">in</span> args_flat:                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 169 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>dispatch.check_arg(arg)                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 170 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">581</span> in <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_infer_params</span>                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 578 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>in_shardings_treedef, in_shardings_leaves, hashable_pytree(in_layouts),             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 579 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>in_avals, in_tree, dbg, device_or_backend_set, have_kwargs)                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 580 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 581 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>jaxpr, consts, out_shardings, out_layouts_flat, attrs_tracked = _pjit_jaxpr(            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 582 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>flat_fun, out_shardings_treedef, out_shardings_leaves,                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 583 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>hashable_pytree(out_layouts), in_type, dbg, device_or_backend_set,                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 584 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>HashableFunction(out_tree, closure=()),                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1202</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_pjit_jaxpr</span>                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1199 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_pjit_jaxpr</span>(fun, out_shardings_treedef, out_shardings_leaves,                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1200 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   </span>out_layouts_thunk, in_type, debug_info, device_or_backend_set,            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1201 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   </span>out_tree, result_paths, inline):                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1202 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>jaxpr, final_consts, out_type, attrs_tracked = _create_pjit_jaxpr(                      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1203 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>fun, in_type, debug_info, result_paths, IgnoreKey(inline))                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1204 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>canonicalized_out_shardings_flat, out_layouts_flat = _check_and_canonicalize_out_shard  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1205 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>out_shardings_treedef, out_shardings_leaves, out_layouts_thunk, out_tree, <span style="color: #00ffff; text-decoration-color: #00ffff">tuple</span>(ou  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">linear_util.py</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> :<span style="color: #0000ff; text-decoration-color: #0000ff">350</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">memoized_fun</span>                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">347 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>ans, stores = result                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">348 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>fun.populate_stores(stores)                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">349 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">else</span>:                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>350 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>ans = call(fun, *args)                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">351 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> explain <span style="color: #ff00ff; text-decoration-color: #ff00ff">and</span> config.explain_cache_misses.value:                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">352 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>explain(fun.f, cache <span style="color: #ff00ff; text-decoration-color: #ff00ff">is</span> new_cache, cache, key, ans)                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">353 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>cache[key] = (ans, fun.stores)                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">pjit.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1146</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_create_pjit_jaxpr</span>                                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1143 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │     </span>lu.annotate(fun, in_type), debug_info=pe_debug)                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1144 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>attrs_tracked = []                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1145 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">else</span>:                                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1146 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>jaxpr, global_out_avals, consts, attrs_tracked = pe.trace_to_jaxpr_dynamic(         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1147 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │     </span>fun, in_type, debug_info=pe_debug)                                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1148 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1149 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># TODO(dougalm,mattjj): enable debug info with attrs_tracked</span>                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">profiler.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">33</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #0000ff; text-decoration-color: #0000ff">5</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">wrapper</span>                                                                                     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">332 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">@wraps</span>(func)                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">333 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">wrapper</span>(*args, **kwargs):                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">334 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">with</span> TraceAnnotation(name, **decorator_kwargs):                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>335 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> func(*args, **kwargs)                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">336 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> wrapper                                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">337 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> wrapper                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">338 </span>                                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/interpreters/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">p</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">artial_eval.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">2322</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">trace_to_jaxpr_dynamic</span>                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2319 </span>) -&gt; <span style="color: #00ffff; text-decoration-color: #00ffff">tuple</span>[Jaxpr, <span style="color: #00ffff; text-decoration-color: #00ffff">list</span>[AbstractValue], <span style="color: #00ffff; text-decoration-color: #00ffff">list</span>[Any], <span style="color: #00ffff; text-decoration-color: #00ffff">list</span>[<span style="color: #00ffff; text-decoration-color: #00ffff">tuple</span>[Any, <span style="color: #00ffff; text-decoration-color: #00ffff">str</span>]]]:                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2320 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">with</span> core.new_main(DynamicJaxprTrace, dynamic=<span style="color: #0000ff; text-decoration-color: #0000ff">True</span>) <span style="color: #0000ff; text-decoration-color: #0000ff">as</span> main:  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># type: ignore</span>            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2321 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>main.jaxpr_stack = ()  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># type: ignore</span>                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>2322 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>jaxpr, out_avals, consts, attrs_tracked = trace_to_subjaxpr_dynamic(                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2323 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>fun, main, in_avals, keep_inputs=keep_inputs, debug_info=debug_info)                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2324 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">del</span> main, fun                                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2325 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> jaxpr, out_avals, consts, attrs_tracked                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/interpreters/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">p</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">artial_eval.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">2344</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">trace_to_subjaxpr_dynamic</span>                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2341 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>trace = DynamicJaxprTrace(main, core.cur_sublevel())                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2342 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>in_tracers = _input_type_to_tracers(trace.new_arg, in_avals)                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2343 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>in_tracers_ = [t <span style="color: #0000ff; text-decoration-color: #0000ff">for</span> t, keep <span style="color: #ff00ff; text-decoration-color: #ff00ff">in</span> <span style="color: #00ffff; text-decoration-color: #00ffff">zip</span>(in_tracers, keep_inputs) <span style="color: #0000ff; text-decoration-color: #0000ff">if</span> keep]                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>2344 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>ans = fun.call_wrapped(*in_tracers_)                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2345 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>out_tracers = <span style="color: #00ffff; text-decoration-color: #00ffff">map</span>(trace.full_raise, ans)                                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2346 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>jaxpr, consts, attrs_tracked = frame.to_jaxpr(out_tracers)                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2347 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">del</span> fun, main, trace, frame, in_tracers, out_tracers, ans                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">linear_util.py</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> :<span style="color: #0000ff; text-decoration-color: #0000ff">192</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">call_wrapped</span>                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">189 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>gen = gen_static_args = out_store = <span style="color: #0000ff; text-decoration-color: #0000ff">None</span>                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">190 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>                                                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">191 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">try</span>:                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>192 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span>ans = <span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.f(*args, **<span style="color: #00ffff; text-decoration-color: #00ffff">dict</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.params, **kwargs))                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">193 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">except</span>:                                                                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">194 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># Some transformations yield from inside context managers, so we have to</span>             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">195 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│     </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># interrupt them before reraising the exception. Otherwise they will only</span>            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">f</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">6</span>                                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 3 </span>                                                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 4 </span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">@jit</span>                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 5 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">f</span>(x):                                                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span> 6 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> x.reshape(jnp.array(x.shape).prod())                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 7 </span>                                                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 8 </span>x = jnp.ones((<span style="color: #0000ff; text-decoration-color: #0000ff">2</span>, <span style="color: #0000ff; text-decoration-color: #0000ff">3</span>))                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 9 </span>f(x)                                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/numpy/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">array_me</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">thods.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">742</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">meth</span>                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">739 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_forward_method_to_aval</span>(name):                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">740 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">meth</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, *args, **kwargs):                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">741 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>__tracebackhide__ = <span style="color: #0000ff; text-decoration-color: #0000ff">True</span>                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>742 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> <span style="color: #00ffff; text-decoration-color: #00ffff">getattr</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.aval, name).fun(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, *args, **kwargs)                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">743 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> meth                                                                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">744 </span>                                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">745 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">_forward_property_to_aval</span>(name):                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/numpy/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">array_me</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">thods.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">148</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_reshape</span>                                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">145 </span><span style="color: #bfbf7f; text-decoration-color: #bfbf7f">  </span><span style="color: #808000; text-decoration-color: #808000">Refer to :func:`jax.numpy.reshape` for full documentation.</span>                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">146 </span><span style="color: #bfbf7f; text-decoration-color: #bfbf7f">  </span><span style="color: #808000; text-decoration-color: #808000">"""</span>                                                                                      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">147 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>__tracebackhide__ = <span style="color: #0000ff; text-decoration-color: #0000ff">True</span>                                                                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>148 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>newshape = _compute_newshape(a, args[<span style="color: #0000ff; text-decoration-color: #0000ff">0</span>] <span style="color: #0000ff; text-decoration-color: #0000ff">if</span> <span style="color: #00ffff; text-decoration-color: #00ffff">len</span>(args) == <span style="color: #0000ff; text-decoration-color: #0000ff">1</span> <span style="color: #0000ff; text-decoration-color: #0000ff">else</span> args)                     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">149 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> order == <span style="color: #808000; text-decoration-color: #808000">"C"</span>:                                                                         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">150 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> lax.reshape(a, newshape, <span style="color: #0000ff; text-decoration-color: #0000ff">None</span>)                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">151 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">elif</span> order == <span style="color: #808000; text-decoration-color: #808000">"F"</span>:                                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/numpy/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">array_me</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">thods.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">116</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">_compute_newshape</span>                                                                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">113 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #00ffff; text-decoration-color: #00ffff">iter</span>(newshape)  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># type: ignore[arg-type]</span>                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">114 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">except</span>:                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">115 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>newshape = [newshape]                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>116 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>newshape = core.canonicalize_shape(newshape)  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f"># type: ignore[arg-type]</span>                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">117 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span>neg1s = [i <span style="color: #0000ff; text-decoration-color: #0000ff">for</span> i, d <span style="color: #ff00ff; text-decoration-color: #ff00ff">in</span> <span style="color: #00ffff; text-decoration-color: #00ffff">enumerate</span>(newshape) <span style="color: #0000ff; text-decoration-color: #0000ff">if</span> <span style="color: #00ffff; text-decoration-color: #00ffff">type</span>(d) <span style="color: #ff00ff; text-decoration-color: #ff00ff">is</span> <span style="color: #00ffff; text-decoration-color: #00ffff">int</span> <span style="color: #ff00ff; text-decoration-color: #ff00ff">and</span> d == -<span style="color: #0000ff; text-decoration-color: #0000ff">1</span>]                <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">118 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> <span style="color: #00ffff; text-decoration-color: #00ffff">len</span>(neg1s) &gt; <span style="color: #0000ff; text-decoration-color: #0000ff">1</span>:                                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">119 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">raise</span> <span style="color: #00ffff; text-decoration-color: #00ffff">TypeError</span>(<span style="color: #808000; text-decoration-color: #808000">"can only specify one unknown axis size with a `-1` value, "</span>           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/home/evan/.pyenv/versions/3.11.9/envs/zeal/lib/python3.11/site-packages/jax/_src/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">core.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">2142</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">canonicalize_shape</span>                                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2139 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> <span style="color: #00ffff; text-decoration-color: #00ffff">tuple</span>(unsafe_map(_canonicalize_dimension, shape))                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2140 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">except</span> <span style="color: #00ffff; text-decoration-color: #00ffff">TypeError</span>:                                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2141 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">pass</span>                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>2142 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">  </span><span style="color: #0000ff; text-decoration-color: #0000ff">raise</span> _invalid_shape_error(shape, context)                                              <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2143 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2144 </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">canonicalize_dim</span>(d: DimSize, context: <span style="color: #00ffff; text-decoration-color: #00ffff">str</span>=<span style="color: #808000; text-decoration-color: #808000">""</span>) -&gt; DimSize:                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2145 </span><span style="color: #bfbfbf; text-decoration-color: #bfbfbf">  </span><span style="color: #808000; text-decoration-color: #808000">"""Canonicalizes and checks for errors in a user-provided shape dimension value.</span>        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">╰──────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
<span style="color: #ff0000; text-decoration-color: #ff0000; font-weight: bold">TypeError: </span>Shapes must be 1D sequences of concrete values of integer type, got 
<span style="font-weight: bold">[</span>Traced<span style="font-weight: bold">&lt;</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">ShapedArray</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #000000; text-decoration-color: #000000">int32</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">[])</span><span style="color: #000000; text-decoration-color: #000000">&gt;with&lt;</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">DynamicJaxprTrace</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">level</span><span style="color: #000000; text-decoration-color: #000000">=</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="color: #000000; text-decoration-color: #000000">/</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;]</span>.
If using `jit`, try using `static_argnums` or applying `jit` to smaller subfunctions.
The error occurred while tracing the function f at <span style="color: #800080; text-decoration-color: #800080">/tmp/ipykernel_176355/</span><span style="color: #ff00ff; text-decoration-color: #ff00ff">1983583872.py</span>:<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span> for jit. This value became
a tracer due to JAX operations on these lines:

  operation a:i32<span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> = convert_element_type<span style="font-weight: bold">[</span><span style="color: #808000; text-decoration-color: #808000">new_dtype</span>=<span style="color: #800080; text-decoration-color: #800080">int32</span> <span style="color: #808000; text-decoration-color: #808000">weak_type</span>=<span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span><span style="font-weight: bold">]</span> b
    from line <span style="color: #800080; text-decoration-color: #800080">/tmp/ipykernel_176355/</span><span style="color: #ff00ff; text-decoration-color: #ff00ff">1983583872.py</span>:<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">6:19</span> <span style="font-weight: bold">(</span>f<span style="font-weight: bold">)</span>
</pre>
</div></div>
</div>
<p>This fails with an error specifying that a tracer was found instead of a 1D sequence of concrete values of integer type. Let’s add some print statements to the function to understand why this is happening:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x = </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x.shape = </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;jnp.array(x.shape).prod() = </span><span class="si">{</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="c1"># comment this out to avoid the error:</span>
  <span class="c1"># return x.reshape(jnp.array(x.shape).prod())</span>

<span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>x = Traced&lt;ShapedArray(float32[2,3])&gt;with&lt;DynamicJaxprTrace(level=1/0)&gt;
x.shape = (2, 3)
jnp.array(x.shape).prod() = Traced&lt;ShapedArray(int32[])&gt;with&lt;DynamicJaxprTrace(level=1/0)&gt;
</pre></div>
</div>
</div>
</div>
<p>Notice that although <code class="docutils literal notranslate"><span class="pre">x</span></code> is traced, <code class="docutils literal notranslate"><span class="pre">x.shape</span></code> is a static value. However, when we use <code class="docutils literal notranslate"><span class="pre">jnp.array</span></code> and <code class="docutils literal notranslate"><span class="pre">jnp.prod</span></code> on this static value, it becomes a traced value, at which point it cannot be used in a function like <code class="docutils literal notranslate"><span class="pre">reshape()</span></code> that requires a static input (recall: array shapes must be static).</p>
<p>A useful pattern is to use <code class="docutils literal notranslate"><span class="pre">numpy</span></code> for operations that should be static (i.e. done at compile-time), and use <code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code> for operations that should be traced (i.e. compiled and executed at run-time). For this function, it might look like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">jit</span>
<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">),))</span>

<span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Magenta">Array</span><span class=" -Color -Color-Bold">([</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">1</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">1</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">1</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">1</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">1</span>., <span class=" -Color -Color-Bold -Color-Bold-Cyan">1</span>.<span class=" -Color -Color-Bold">]</span>, <span class=" -Color -Color-Yellow">dtype</span>=<span class=" -Color -Color-Magenta">float32</span><span class=" -Color -Color-Bold">)</span>
</pre></div>
</div>
</div>
</div>
<p>For this reason, a standard convention in JAX programs is to <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">numpy</span> <span class="pre">as</span> <span class="pre">np</span></code> and <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">jax.numpy</span> <span class="pre">as</span> <span class="pre">jnp</span></code> so that both interfaces are available for finer control over whether operations are performed in a static matter (with <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, once at compile-time) or a traced manner (with <code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code>, optimized at run-time).</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="quickstart.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">JAX Quickstart</p>
      </div>
    </a>
    <a class="right-next"
       href="Common_Gotchas_in_JAX.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">🔪 JAX - The Sharp Bits 🔪</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jax-vs-numpy">JAX vs. NumPy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numpy-lax-xla-jax-api-layering">NumPy, lax &amp; XLA: JAX API layering</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#to-jit-or-not-to-jit">To JIT or not to JIT</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jit-mechanics-tracing-and-static-variables">JIT mechanics: tracing and static variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#static-vs-traced-operations">Static vs Traced Operations</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The JAX authors
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, The JAX Authors. NumPy and SciPy documentation are copyright the respective authors..
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>